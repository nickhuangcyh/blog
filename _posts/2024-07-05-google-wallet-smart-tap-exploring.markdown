---
layout: single
title: "æ·±å…¥è§£æ Google Wallet Smart Tapï¼šæœªä¾†çš„æ”¯ä»˜æ–¹å¼"
date: 2024-07-05 20:00:00 +0800
excerpt: "æ¢ç´¢ Google Wallet Smart Tap çš„é‹ä½œåŸç†å’Œå®ƒå¦‚ä½•æ”¹è®Šæˆ‘å€‘çš„æ”¯ä»˜ç¿’æ…£ã€‚æœ¬æ–‡å°‡å¸¶ä½ äº†è§£å…¶èƒŒå¾Œçš„æŠ€è¡“ï¼Œä»¥åŠå®ƒå°æœªä¾†æ”¯ä»˜ç”Ÿæ…‹ç³»çµ±çš„å½±éŸ¿ã€‚"
header:
  overlay_image: /assets/images/mika-baumeister-m7HWPWVjfJ4-unsplash.jpg
  teaser: /assets/images/mika-baumeister-m7HWPWVjfJ4-unsplash.jpg
tags: [Google Wallet, Smart Tap, NFC, Payment Systems]
categories: [Pay, Technology]
---

## å‰è¨€

æœ€è¿‘å› ç‚ºå·¥ä½œéœ€è¦ï¼Œæœ‰ç ”ç©¶ Google Wallet Smart Tap ç›¸é—œæŠ€è¡“ï¼Œå› æ­¤æƒ³å¯«ä¸€ç¯‡æ–‡ç« è¨˜éŒ„ï¼Œä¸€æ–¹é¢èƒ½å¹«è‡ªå·±è¤‡ç¿’ï¼Œå¦ä¸€æ–¹ä¾¿ä¹Ÿå¸Œæœ›é€™ç¯‡æ–‡ç« èƒ½å¹«åŠ©åˆ°å…¶ä»–é–‹ç™¼è€…ã€‚ğŸ™‚

## ä»€éº¼æ˜¯ NFC

NFCï¼ˆè¿‘å ´é€šè¨Šï¼‰æ˜¯ä¸€ç¨®çŸ­è·é›¢ç„¡ç·šé€šè¨ŠæŠ€è¡“ï¼Œå…è¨±å…©å€‹è£ç½®åœ¨å¹¾å˜ç±³çš„è·é›¢å…§é€²è¡Œé€šè¨Šã€‚å®ƒå»£æ³›ç”¨æ–¼å„ç¨®æ‡‰ç”¨ï¼ŒåŒ…æ‹¬æ”¯ä»˜ã€ç¥¨å‹™ã€è³‡æ–™äº¤æ›ç­‰ã€‚

## Google Wallet Smart Tap ç°¡ä»‹

Smart Tap æ˜¯ Google åŸºæ–¼ NFC æŠ€è¡“é–‹ç™¼çš„å°ˆæœ‰çš„è¿‘å ´é€šè¨Šå”è­°ï¼Œç”¨æ–¼åœ¨ç§»å‹•è¨­å‚™å’Œ NFC çµ‚ç«¯ä¹‹é–“å‚³è¼¸æ•¸æ“šã€‚

> å¦‚æœä½ å€‘å…¬å¸æ˜¯å¯¦ä½œ Terminal ç«¯ï¼Œå¿…é ˆç²å¾—èªè­‰æ‰èƒ½ä½¿ç”¨æ­¤å”è­°ï¼Œé€™éƒ¨åˆ†æˆ‘æœ‰å¯«ä¿¡å• Google å¾—åˆ°å¦‚ä¸‹å›è¦†ï¼Œéœ€è¦æä¾›è³‡è¨Šç°½ç½²å”è­°ï¼ŒGoogle æ‰æœƒæä¾›æ©Ÿå¯†æ–‡ä»¶è®“ä½ å¯¦ä½œã€‚
>
> If you are a terminal provider and would like to certify your terminal for use with Google Wallet, please provide more details about your terminal, intended functionality and target country/region. The documentation needed for Smart Tap certification is locked behind an NDA.
>
> Once I have this information, my team and I will review and if the decision is to move forward with your request, we will begin the process of onboarding, starting with an NDA.

## äº‹å‰æ¢ä»¶

æˆ‘å€‘éœ€è¦å®Œæˆå…©å€‹æ¢ä»¶æ‰èƒ½é–‹å§‹è¨­ç½® smart tap

1. å‰µå»º pass class è·Ÿ pass object(s)
2. èˆ‡æ”¯æ´ Smart Tap çš„çµ‚ç«¯ä¾›æ‡‰å•†å»ºç«‹åˆä½œé—œä¿‚

ç›®å‰æœ‰æ”¯æ´ Smart Tap çš„ä¾›æ‡‰å•†å¦‚ä¸‹

- Advanced Card Systems Ltd.
- Axess AG
- Castles Technology
- Contactless Technologies B. V.
- Dot Origin
- Embed International
- Equinox
- HID
- IDTech
- Infinite Peripherals
- Ingenico
- Intercard Inc.
- Janam
- On Track Innovations
- Pax
- PinvAccess
- Radius Network
- Skidata
- Socket Mobile
- SpringCard
- Techsigno SRL
- UIC Payworld Inc.
- Verifone
- XAC
- Zebra

## Identifiers

åœ¨å‰µå»º pass class è·Ÿ pass object(s) ä¹‹å‰ï¼Œæˆ‘å€‘éœ€è¦å…ˆçŸ¥é“ä¸€äº› Smart Tap protocol æ‰€ä½¿ç”¨çš„ Identifiers

- Redemption Issuer ID (å…Œæ›æ ¸ç™¼æ©Ÿæ§‹ ID)
- Collector ID
- Pass class ID

### Issuer ID (æ ¸ç™¼æ©Ÿæ§‹ ID)

Issuer ID æ˜¯ Google Wallet ç™¼å¡æ©Ÿæ§‹å”¯ä¸€è­˜åˆ¥ç¢¼ï¼Œå¯ä»¥åœ¨ [Google Pay & Wallet Console](https://pay.google.com/business/console/home?hl=zh-cn) ä¸­æ‰¾åˆ°

### Redemption Issuer ID (å…Œæ›æ ¸ç™¼æ©Ÿæ§‹ ID)

Redemption Issuer ID æ˜¯ä¸€ç¨®ç‰¹å®šçš„ Issuer IDï¼Œå¯ä»¥æŠŠ Redemption Issuer ID ç•¶æˆæ˜¯å–®ä¸€å•†å®¶ï¼ŒIssuer æ˜¯å„²å­˜å¤šå€‹å•†å®¶çš„ pass class å¹³å°çš„"é›†åˆå•†å®¶"

Issuer ID å¯ä»¥ä»£è¡¨å•†å®¶ã€å„ªæƒ æä¾›æ–¹ã€å•†å ´(e.g. SOGO)ã€çµ‚ç«¯æ©Ÿè£½é€ å•†ç­‰ç­‰...ï¼Œpass class & object(s) é–‹ç™¼å‡ºä¾†å¾Œï¼Œæœƒèˆ‡ Redemption Issuer ID ç›¸é—œè¯ï¼ŒIssuer ID åŒ…å«äº† pass class IDs è·Ÿ object IDs

| ID        | Format                | Notes                                                                                                |
| --------- | --------------------- | ---------------------------------------------------------------------------------------------------- |
| Class ID  | issuerId.classSuffix  | The classSuffix is a unique, developer-defined value for a specific pass class (e.g. a loyalty tier) |
| Object ID | issuerId.objectSuffix | The objectSuffix is a unique, developer-defined value for a specific pass object (such as a user ID) |

### Collector ID (æ”¶æ¬¾æ–¹ ID)

- ç•¶å•†å®¶çš„çµ‚ç«¯æ©Ÿæ”¯æŒ Smart Tap, å‰‡ Redemption Issuer å°‡æœ‰ä¸€çµ„ Collector ID
- Collector ID æ˜¯ä¸€å€‹ 8 ä½æ•¸å­—çš„ ID
- ç•¶ User å°‡è¨­å‚™è§¸ç¢°æ”¯æ´ Smart Tap çš„çµ‚ç«¯æ™‚ï¼Œçµ‚ç«¯æœƒå°‡ Collector ID ç™¼é€åˆ° User çš„è¨­å‚™ã€‚ç„¶å¾Œè¨­å‚™ä½¿ç”¨è©² Collector ID çš„ public key å‘çµ‚ç«¯é€²è¡Œèº«ä»½é©—è­‰(å¾Œé¢ç­‰ç­‰æœƒæåˆ°é€šè¨Šæµç¨‹)

> 1. ä¸€å€‹ Issuer ID åªèƒ½åˆ†é…ä¸€çµ„ Collector ID
> 2. Collector ID åœ¨æ‰€æœ‰ Issuer IDs éƒ½æ˜¯å”¯ä¸€çš„

### Pass Class ID (ç¥¨è­‰é¡ ID)

ç”¨æ–¼æ¨™ç¤ºç‰¹å®šå±¤ç´šæˆ–ç¥¨è­‰é¡å‹ã€‚æ¡ç”¨ä»¥ä¸‹æ ¼å¼

> issuerId.classSuffix

classSuffix æ˜¯ç”±é–‹ç™¼è€…å®šç¾©æ­¤ pass class ç¨æœ‰çš„å€¼ï¼Œé€éæ­¤ pass class æ‰€å»ºç«‹å‡ºä¾†çš„ object class å¯ä»¥è¢«ä¿å­˜åˆ° Google Wallet App ä¸­ã€‚

> Pass Class ID ç‚ºå–®ä¸€çš„ Issuer å¸³è™Ÿæ‰€æœ‰ï¼Œä½†å¯ä»¥èˆ‡å¤šå€‹ Redemption Issuer ç›¸é—œè¯

## Communication Flow (é€šè¨Šæµç¨‹)

çµ‚ç«¯æœƒä½¿ç”¨ Collector ID ä¾†æ¨™ç¤ºè‡ªèº«ï¼ŒCollector ID æœƒ mapping åˆ°ä¸€å€‹ Redemption Issuer IDï¼Œç•¶ç™¼ç”Ÿ Smart Tap æ™‚ï¼Œçµ‚ç«¯æœƒå°‡è‡ªèº«çš„ Collector ID å‚³è¼¸çµ¦ User çš„è¨­å‚™ã€‚ç„¶å¾Œ Google Wallet App æœƒæª¢æŸ¥æ¯å€‹å„²å­˜åœ¨è¨­å‚™ä¸­çš„ pass class ID åŠ Collector IDã€‚æ‰¾åˆ°ä¸€å€‹æˆ–å¤šå€‹åŒ¹é…çš„ç¥¨è­‰ï¼Œç„¶å¾Œ Google Wallet App æœƒå°‡é€™äº›åŒ¹é…çš„ç¥¨è­‰å‚³è¼¸åˆ°çµ‚ç«¯ã€‚

### ç¯„ä¾‹ 1: ä¸€å€‹ Redemption Issuer

![google_wallet_smart_tap_communication_flow_example1]({{ site.baseurl }}/assets/images/google_wallet_smart_tap_communication_flow_example1.png)

ä¸Šåœ–æœ‰å…©å€‹ä¸åŒçš„ Issuer

- Issuer `2018` æ˜¯ pass é–‹ç™¼è€… (Aggregator)
- Issuer `1990` æ˜¯å•†å®¶ fooPizza (Redemption Issuer)

Redemption Issuer - fooPizza æƒ³è¦ç‚ºä»–å€‘çš„ç¥¨è­‰å•Ÿç”¨ Smart Tap åŠŸèƒ½ï¼ŒAggregator åŠ Redemption Issuer å¿…é ˆå®Œæˆä¸‹é¢çš„æ­¥é©Ÿï¼Œæ‰èƒ½ç‚ºå•†å®¶çµ‚ç«¯å•Ÿç”¨ Smart Tap
| æ­¥é©Ÿ | è§’è‰² | èªªæ˜ |
|:----:|:------------:|:---------------------------------------------------------------------------------------------------------------------|
| 1 | Aggregator | å‰µå»ºç¥¨è­‰é¡å’Œå°è±¡ï¼ˆåœ¨åœ–ä¸­åˆ†åˆ¥ç‚º abc å’Œ 123ï¼‰ã€‚ |
| 2 | Aggregator | å°‡ Redemption Issuer çš„ ID æ·»åŠ åˆ°ç¥¨è­‰é¡çš„ `redemptionIssuers` å±¬æ€§ä¸­ã€‚é€™æœƒå‘ŠçŸ¥ Google éŒ¢åŒ…ï¼Œç™¼å¡æ©Ÿæ§‹ ID 1990 å¯ä»¥å…Œæ›å¼•ç”¨æ­¤é¡çš„ç¥¨è­‰å°è±¡ã€‚ |
| 3 | Redemption Issuer | ç²å– Collector IDï¼ˆåœ¨åœ–ä¸­ï¼Œ12345678ï¼‰ã€‚ |
| 4 | Redemption Issuer | åœ¨è¦ä½¿ç”¨çš„æ¯å€‹æ”¯æŒ Smart Tap çš„çµ‚ç«¯ä¸Šè¨­ç½® Collector ID 12345678ã€‚ä»»ä½•é¡ ID ç‚º abc ä¸” Collector ID ç‚º 12345678 çš„ç‰©ä»¶éƒ½å°‡å‚³é€çµ¦ Reader |

### ç¯„ä¾‹ 2: å¤šå€‹ Redemption Issuer

ä¸€å€‹ pass class å¯ä»¥æœ‰å¤šå€‹ Redemption Issuerï¼Œç‚ºäº†èƒ½å¤ å…Œæ›ç‰¹å®š pass classï¼ŒRedemption Issuer ID å¿…é ˆåŒ…å«åœ¨ pass class å‰µå»ºæ™‚çš„ `redemptionIssuers` å±¬æ€§ä¸­ï¼Œç„¶å¾Œæ¯å€‹ Redemption Issuer éƒ½æœ‰è‡ªå·±çš„ Collector IDï¼Œæ­¤ ID æœƒåœ¨çµ‚ç«¯ä¸Šé…ç½®

![google_wallet_smart_tap_communication_flow_example2]({{ site.baseurl }}/assets/images/google_wallet_smart_tap_communication_flow_example2.png)

ä¸Šåœ–æœ‰ä¸‰å€‹ä¸åŒçš„ Issuer

- Issuer `8088` æ˜¯ pass é–‹ç™¼è€… (Aggregator)
- Issuer `1990` æ˜¯å•†å®¶ fooPizza (Redemption Issuer)
- Issuer `2018` æ˜¯å•†å®¶ yumPie (Redemption Issuer)

Aggregator è·Ÿ Redemption Issuers å¿…é ˆå®Œæˆä¸‹é¢çš„æ­¥é©Ÿï¼Œæ‰èƒ½ç‚ºå•†å®¶çµ‚ç«¯å•Ÿç”¨ Smart Tap

| æ­¥é©Ÿ |       è§’è‰²        | èªªæ˜                                                                                                                                             |
| :--: | :---------------: | :----------------------------------------------------------------------------------------------------------------------------------------------- |
|  1   |    Aggregator     | å»ºç«‹ç¥¨è­‰é¡åˆ¥å’Œç‰©ä»¶ (åˆ†åˆ¥åœ¨åœ–ä¸­ç‚º abc å’Œ 123)ã€‚                                                                                                   |
|  2   |    Aggregator     | è«‹åœ¨ç¥¨è­‰é¡åˆ¥çš„ `redemptionIssuers` å±¬æ€§ä¸­åŠ å…¥ Redemption Issuer IDã€‚é€™æœƒè®“ Google éŒ¢åŒ…ç­è§£ Issuer ID 1990 å’Œ 2018 å¯å…Œæ›åƒç…§é€™å€‹é¡åˆ¥çš„ç¥¨è­‰ç‰©ä»¶ã€‚ |
|  3   | Redemption Issuer | å–å¾— Collector ID (åœ¨åœ–è¡¨ä¸­ï¼Œæ˜¯ fooPizza çš„ 12345678ï¼Œä»¥åŠ yumPie çš„ 18802001)ã€‚                                                                 |
|  4   | Redemption Issuer | åœ¨æ”¯æ´ Smart Tap çš„æ¯å€‹çµ‚ç«¯æ©Ÿä¸Šè¨­å®šå°æ‡‰çš„ Collector IDã€‚åªè¦ç‰©ä»¶å…·æœ‰é¡åˆ¥ ID abc ä¸”æœ‰ç›¸ç¬¦çš„ Collector IDï¼Œç³»çµ±å°±æœƒå°‡è©²ç‰©ä»¶å‚³é”çµ¦ Readerã€‚         |

### ç¯„ä¾‹ 3: æ²’æœ‰é›†åˆå•†å®¶ (No Aggregator)

æˆ‘å€‘ä¹Ÿå¯ä»¥ä½¿ç”¨åŒä¸€å€‹ Issuer å¸³æˆ¶é–‹ç™¼åŠæ ¸ç™¼ç¥¨è­‰é¡ï¼Œæ²’æœ‰ Aggregator ç®¡ç†å¤šå€‹ Redemption Issuer çš„ç¥¨è­‰é¡ã€‚å¦‚æœè¦å…Œæ›ç‰¹å®šç¥¨è­‰é¡ï¼Œé–‹ç™¼è€…å¿…é ˆåœ¨é¡åˆ¥çš„ `redemptionIssuers` å±¬æ€§ä¸­åŠ å…¥ Issuer IDã€‚é–‹ç™¼äººå“¡å¿…é ˆå–å¾— Collector IDï¼Œä¸¦åœ¨ Smart Tap çµ‚ç«¯ä¸Šè¨­å®š Collector IDã€‚

![google_wallet_smart_tap_communication_flow_example3]({{ site.baseurl }}/assets/images/google_wallet_smart_tap_communication_flow_example3.png)

ç¥¨è­‰é–‹ç™¼è€…å¿…é ˆå®Œæˆä¸‹åˆ—æ­¥é©Ÿï¼Œç‚ºå•†å®¶çµ‚ç«¯æ©Ÿå•Ÿç”¨ Smart Tapã€‚

| æ­¥é©Ÿ |      è§’è‰²      | èªªæ˜                                                                                                                                     |
| :--: | :------------: | :--------------------------------------------------------------------------------------------------------------------------------------- |
|  1   | Pass Developer | å»ºç«‹ç¥¨è­‰é¡åˆ¥å’Œç‰©ä»¶ (åˆ†åˆ¥åœ¨åœ–ä¸­ç‚º abc å’Œ 123)ã€‚                                                                                           |
|  2   | Pass Developer | åœ¨ç¥¨è­‰é¡åˆ¥çš„ `redemptionIssuers` å±¬æ€§ä¸­åŠ å…¥ä»–å€‘çš„ Issuer IDã€‚é€™æœƒè®“ Google Wallet ç­è§£ Issuer ID 2018 å·²ç²æº–å…Œæ›åƒç…§é€™å€‹é¡åˆ¥çš„ç¥¨è­‰ç‰©ä»¶ã€‚ |
|  3   | Pass Developer | å–å¾— Collector ID (åœ–ä¸­çš„ 12345678)ã€‚                                                                                                    |
|  4   | Pass Developer | åœ¨æ”¯æ´ Smart Tap çš„æ¯å€‹çµ‚ç«¯æ©Ÿä¸Šè¨­å®šå°æ‡‰çš„ Collector IDã€‚åªè¦ç‰©ä»¶å…·æœ‰é¡åˆ¥ ID abc ä¸”æœ‰ç›¸ç¬¦çš„ Collector IDï¼Œç³»çµ±å°±æœƒå°‡è©²ç‰©ä»¶å‚³é”çµ¦ Readerã€‚ |

## User experience and behavior

çµ‚ç«¯æ©Ÿå’Œ Google éŒ¢åŒ…æ‡‰ç”¨ç¨‹å¼ä¹‹é–“å‚³è¼¸çš„å…§å®¹è¡Œç‚ºï¼Œè¦–ä½¿ç”¨è€…å’Œä»–å€‘ç•¶ä¸‹èˆ‡ Google éŒ¢åŒ…æ‡‰ç”¨ç¨‹å¼äº’å‹•çš„æ–¹å¼è€Œå®šã€‚

### æƒ…å¢ƒ 1ï¼šä½¿ç”¨è€…é–‹å•Ÿç‰¹å®šç¥¨è­‰

| æ­¥é©Ÿ |   è§’è‰²   | èªªæ˜                                                                                     |
| :--: | :------: | :--------------------------------------------------------------------------------------- |
|  1   |   User   | åœ¨ Google éŒ¢åŒ…æ‡‰ç”¨ç¨‹å¼ä¸­é¸å–ç‰¹å®šç¥¨è­‰ã€‚                                                   |
|  2   |   User   | è¼•è§¸æ”¯æ´ Smart Tap çš„æ„Ÿæ‡‰å¼åˆ·å¡æ©Ÿã€‚                                                      |
|  3   | Terminal | (Collector ID ç›¸ç¬¦) ç¥¨è­‰æœƒå‚³é€è‡³çµ‚ç«¯æ©Ÿã€‚<br>(Collector ID ä¸ç›¸ç¬¦) ç¥¨è­‰ä¸æœƒå‚³é€è‡³çµ‚ç«¯æ©Ÿã€‚ |

> å¦‚æœç¥¨è­‰ä¸Šçš„ Collector ID èˆ‡çµ‚ç«¯æ©Ÿçš„ Collector ID ç›¸ç¬¦ï¼Œç„¡è«–ç¥¨è­‰æ˜¯å¦æœ‰æ•ˆ (ä¾‹å¦‚ç¥¨è­‰ç‰©ä»¶å·²éæœŸ)ï¼Œç³»çµ±ä¾ç„¶æœƒå‚³é€ç¥¨è­‰ã€‚

### æƒ…å¢ƒ 2ï¼šGoogle éŒ¢åŒ…é¦–é åˆ†é æˆ–è§£é–çš„è¢å¹•æª¢è¦–ç•«é¢

| æ­¥é©Ÿ |   è§’è‰²   | èªªæ˜                                                                                                                                   |
| :--: | :------: | :------------------------------------------------------------------------------------------------------------------------------------- |
|  1   |   User   | åœ¨ Google éŒ¢åŒ…æ‡‰ç”¨ç¨‹å¼ä¸­é–‹å•Ÿã€Œé¦–é ã€åˆ†é ï¼Œæˆ–è§£é–è£ç½®çš„è¢å¹•ã€‚                                                                           |
|  2   |   User   | è¼•è§¸æ”¯æ´ Smart Tap çš„æ„Ÿæ‡‰å¼åˆ·å¡æ©Ÿã€‚                                                                                                    |
|  3   | Terminal | (å–®ä¸€æœ‰æ•ˆçš„ Collector ID ç›¸ç¬¦) ç¥¨è­‰æœƒå‚³é€è‡³çµ‚ç«¯æ©Ÿã€‚<br>(å¤šå€‹æœ‰æ•ˆçš„ Collector ID ç›¸ç¬¦) é¡¯ç¤ºæœ‰æ•ˆç¥¨è­‰çš„è¼ªè½‰ä»‹é¢ï¼Œä¸¦å‚³é€ä½¿ç”¨è€…é¸å–çš„é …ç›®ã€‚ |

## Setup

### Enable the Google Wallet API

1. ç™»å…¥ [Google Cloud console](https://console.cloud.google.com/)
2. å¦‚æœä½ æ²’æœ‰ Google Cloud project, å‰µå»ºä¸€å€‹æ–°çš„ (see [Creating and managing projects](https://cloud.google.com/resource-manager/docs/creating-managing-projects) for more information)
3. ç‚ºä½ çš„å°ˆæ¡ˆå•Ÿå‹• [Google Wallet API](https://console.cloud.google.com/apis/library/walletobjects.googleapis.com) (also referred to as Google Pay for Passes API)

### Create a service account and key

è¦èª¿ç”¨ Google Wallet APIï¼Œéœ€è¦ä¸€å€‹ service account å’Œä¸€å€‹ service account keyã€‚service account æ˜¯èª¿ç”¨ Google Wallet API çš„èº«ä»½è­˜åˆ¥ã€‚service account key åŒ…å«ä¸€å€‹ private keyï¼Œç”¨æ–¼å°‡æ‚¨çš„æ‡‰ç”¨ç¨‹å¼è­˜åˆ¥ç‚ºè©² service accountã€‚é€™å€‹ key éå¸¸æ•æ„Ÿï¼Œå› æ­¤éœ€è¦å¦¥å–„ä¿ç®¡ã€‚

#### Create a service account

1. åœ¨ Google Cloud console ä¸­æ‰“é–‹ [Service Accounts](https://console.cloud.google.com/iam-admin/serviceaccounts/create)
2. ç‚ºä½ çš„ service account è¼¸å…¥åç¨±ã€IDã€æè¿°ã€‚
3. é¸æ“‡ **CREATE AND CONTINUE**
4. é¸æ“‡ **DONE**

#### Create a service account key

1. é¸æ“‡ä½ çš„ service account
2. é¸æ“‡ **KEYS** menu
3. é¸æ“‡ **ADD KEY**, then **Create new key**
4. é¸æ“‡ the **JSON** key type
5. é¸æ“‡ **CREATE**

#### Set the GOOGLE_APPLICATION_CREDENTIALS environment variable

GOOGLE_APPLICATION_CREDENTIALS ç’°å¢ƒè®Šæ•¸è¢« Google SDK ä½¿ç”¨ä¾†ä½œç‚º Service Account çš„èº«ä»½é©—è­‰ä»¥åŠè¨ªå• Google Cloud é …ç›®çš„ä¸åŒ APIã€‚

1. æŒ‰ç…§ [Google Cloud Service account å¯†é‘°æ–‡ä»¶](https://cloud.google.com/docs/authentication/provide-credentials-adc#local-key) ä¸­çš„æŒ‡ç¤ºè¨­ç½® GOOGLE_APPLICATION_CREDENTIALS ç’°å¢ƒè®Šæ•¸ã€‚

å¯ä»¥åœ¨ terminal è¼¸å…¥ä¸‹é¢æŒ‡ä»¤ï¼Œæˆ–ç›´æ¥åŠ åˆ° .bashrc or .zshrc å³å¯

```bash
export GOOGLE_APPLICATION_CREDENTIALS="/Users/nickhuang/Documents/wallet_serviceaccount_key.json"
```

2. åœ¨ Terminal è¼¸å…¥ä¸‹é¢æŒ‡ä»¤ä¾†ç¢ºå®šæœ‰æ­£ç¢ºé…ç½®

```bash
echo $GOOGLE_APPLICATION_CREDENTIALS
```

#### Authorize the service account

æœ€å¾Œï¼Œæˆ‘å€‘é‚„éœ€è¦æˆæ¬Š service account ä¾†ç®¡ç† Google Wallet passesã€‚

1. æ‰“é–‹ [Google Pay & Wallet Console](https://pay.google.com/business/console)
2. é¸æ“‡ **Users**
3. é¸æ“‡ **Invite a user**
4. è¼¸å…¥ service account çš„ emailï¼ˆä¾‹å¦‚ï¼štest-svc@myproject.iam.gserviceaccount.comï¼‰
5. å¾ **Access level** ä¸‹æ‹‰èœå–®ä¸­é¸æ“‡ **Developer** æˆ– **Admin**
6. é¸æ“‡ **Invite**

## Issuer account configuration (æ ¸ç™¼æ©Ÿæ§‹å¸³æˆ¶è¨­å®š)

### Create a new Issuer account

1. æ‰“é–‹ [Google Pay & Wallet Console](https://pay.google.com/business/console)
2. æŒ‰ç…§è¢å¹•ä¸Šçš„æŒ‡ç¤ºå‰µå»ºä¸€å€‹ç™¼è¡Œè€…å¸³æˆ¶
3. é¸æ“‡ **Google Wallet API**
4. ç¢ºèªæ‚¨å·²ç­è§£æœå‹™æ¢æ¬¾å’Œéš±ç§æ”¿ç­–
5. å°‡ Issuer ID å€¼è¤‡è£½åˆ°è¨˜äº‹æœ¬æˆ–å…¶ä»–ä½ç½®
6. åœ¨ **Manager** æ¨™ç±¤ä¸‹é¸æ“‡ **Set up test accounts**
7. æ·»åŠ æ‚¨è¦åƒåŠ æ¸¬è©¦çš„ä»»ä½• email address

### ç‚º Issuer account ä¸Šå‚³ public key

> æ³¨æ„ï¼š å¦‚æœæ„Ÿæ‡‰å¼åˆ·å¡æ©Ÿä¾›æ‡‰å•†éœ€è¦æ‚¨å…ˆæä¾› Collector IDï¼Œæ‰æœƒçµ¦æ‚¨ Public Keyï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸‹æ–¹çš„ç¤ºç¯„é‡‘é‘°ç”¢ç”Ÿ Public Keyã€‚æ„Ÿæ‡‰å¼åˆ·å¡æ©Ÿä¾›æ‡‰å•†å‘æ‚¨æä¾›å¯¦éš›çš„å…¬é–‹é‡‘é‘°ä¹‹å¾Œï¼Œè«‹å‹™å¿…ç§»é™¤é€™çµ„ç¤ºç¯„é‡‘é‘°ã€‚

```apacheconf
-----BEGIN PUBLIC KEY-----
MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEchyXj869zfmKhRi9xP7f2AK07kEo
4lE7ZlWTN14jh4YBTny+hRGRXcUzevV9zSSPJlPHpqqu5pEwlv1xyFvE1w==
-----END PUBLIC KEY-----
```

ğŸ—‚ï¸ [add_a_smart_tap_key.js]

```javascript
const { GoogleAuth } = require("google-auth-library");

const keyFilePath =
  process.env.GOOGLE_APPLICATION_CREDENTIALS || "/path/to/key.json";
const baseUrl = "https://walletobjects.googleapis.com/walletobjects/v1";
const credentials = require(keyFilePath);

const httpClient = new GoogleAuth({
  credentials: credentials,
  scopes: "https://www.googleapis.com/auth/wallet_object.issuer",
});

(async () => {
  /**
   * Add a new public key to an Issuer account.
   *
   * @param {string} issuerId The issuer ID being used for this request.
   */
  async function addSmartTapKey(issuerId) {
    // New smart tap key information
    let patchBody = {
      smartTapMerchantData: {
        authenticationKeys: [
          {
            id: 1,
            publicKeyPem:
              "-----BEGIN PUBLIC KEY-----\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEchyXj869zfmKhRi9xP7f2AK07kEo\n4lE7ZlWTN14jh4YBTny+hRGRXcUzevV9zSSPJlPHpqqu5pEwlv1xyFvE1w==\n-----END PUBLIC KEY-----",
          },
        ],
      },
    };

    try {
      let response = await httpClient.request({
        url: `${baseUrl}/issuer/${issuerId}`,
        method: "PATCH",
        data: patchBody,
      });

      console.log("Issuer patch response");
      console.log(response);
    } catch (err) {
      console.error("Error adding Smart Tap key:", err);
    }
  }

  // ä½¿ç”¨æ‚¨è¦æ¸¬è©¦çš„ issuerId èª¿ç”¨ addSmartTapKey å‡½æ•¸
  let issuerId = "Your issuer ID";
  await addSmartTapKey(issuerId);
})();
```

```bash
node add_a_smart_tap_key.js
```

åˆ° Google Pay & Wallet Console çš„ Google Wallet API -> å…¶ä»–åŠŸèƒ½ï¼Œå°±æœƒçœ‹åˆ° public key å·²æˆåŠŸä¸Šå‚³ä¸”ç”¢ç”Ÿå‡º Collector ID

![google_wallet_smart_tap_public_key]({{ site.baseurl }}/assets/images/google_wallet_smart_tap_public_key.png)

### å–å¾— Collector ID

ğŸ—‚ï¸ [get_collector_id.js]

```javascript
const { GoogleAuth } = require("google-auth-library");

// TODO: Define issuer ID
let issuerId = "Your issuer ID";
const keyFilePath =
  process.env.GOOGLE_APPLICATION_CREDENTIALS || "/path/to/key.json";

const baseUrl = "https://walletobjects.googleapis.com/walletobjects/v1";

const credentials = require(keyFilePath);

const httpClient = new GoogleAuth({
  credentials: credentials,
  scopes: "https://www.googleapis.com/auth/wallet_object.issuer",
});

async function getCollectorId(issuerId) {
  try {
    let response = await httpClient.request({
      url: `${baseUrl}/issuer/${issuerId}`,
      method: "GET",
    });

    console.log("Issuer response");
    console.log(response);

    return response.data.smartTapMerchantData.smartTapMerchantId;
  } catch (error) {
    console.error("Error fetching collector ID:", error);
    throw error;
  }
}

// Call the function and log the result
getCollectorId(issuerId)
  .then((collectorId) => {
    console.log("Collector ID:", collectorId);
  })
  .catch((error) => {
    console.error("Failed to get Collector ID:", error);
  });
```

```bash
node get_collector_id.js
```

## Merchant configuration (å•†å®¶è¨­å®š)

- ç‰¹å®šå•†å®¶çš„ Issuer account ID
- è¦å•Ÿç”¨æ™ºæ…§æ„Ÿæ‡‰åŠŸèƒ½çš„ Redemption Issuer ID
- å·²è¨­å®š smart tap çš„ç¥¨è­‰é¡åˆ¥

### Merchant configuration (å•†å®¶è¨­å®š)

ä¸‹åˆ—æ­¥é©Ÿæ¦‚è¿°å•†å®¶è¨­å®šæ™ºæ…§æ„Ÿæ‡‰åŠŸèƒ½çš„è¨­å®šï¼š

1. å‘æ„Ÿæ‡‰å¼åˆ·å¡æ©Ÿä¾›æ‡‰å•†ç´¢å–å…¬é–‹é‡‘é‘°å’Œé‡‘é‘°ç‰ˆæœ¬ã€‚çµ‚ç«¯æ©Ÿä¾›æ‡‰å•†å¯èƒ½æœƒå…ˆè¦æ±‚æ”¶é›†å™¨ IDã€‚åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œè«‹å®Œæˆæ ¸ç™¼è€…è¨­å®šä¸­æ‰€è¿°çš„æ­¥é©Ÿç”¢ç”Ÿæ”¶é›†å™¨ IDï¼Œç„¶å¾Œè¿”å›é€™å€‹é é¢ã€‚
2. å°‡æ”¶é›†å™¨ ID æä¾›çµ¦æ„Ÿæ‡‰å¼åˆ·å¡æ©Ÿä¾›æ‡‰å•†ã€‚
3. å°‡ä»¥ä¸‹è³‡è¨Šæä¾›çµ¦å•†å®¶ï¼š
   - Redemption Issuer IDï¼Œä»¥åŠ Google Pay & Wallet Console çš„ Link
   - Collector ID
4. é€šçŸ¥å•†å®¶æ‡‰æ°¸ä¹…å„²å­˜ Redemption Issuer ID å’Œ Collector IDã€‚å¦‚æœç¥¨è­‰é–‹ç™¼äººå“¡éœ€è¦å•Ÿç”¨é¡åˆ¥ä»¥é€²è¡Œæ™ºæ…§æ„Ÿæ‡‰å…Œæ›åŠŸèƒ½ï¼Œå•†å®¶å°±å¿…é ˆæä¾› Redemption Issuer IDã€‚

### çµ‚ç«¯æ©Ÿè¨­å®š

æ„Ÿæ‡‰å¼åˆ·å¡æ©Ÿä¾›æ‡‰å•†å¿…é ˆè² è²¬ç‚ºå•†å®¶ä½ç½®ä½¿ç”¨çš„æ‰€æœ‰çµ‚ç«¯æ©Ÿè¨­å®šä¸‹åˆ—å±¬æ€§ã€‚é€™äº›å€¼æ˜¯ç”± Redemption Issuer æä¾›ã€‚

- Collector ID
- Key version
- Private key

ç‚ºæ„Ÿæ‡‰å¼åˆ·å¡æ©Ÿè¨­å®šæ™ºæ…§æ„Ÿæ‡‰åŠŸèƒ½å¾Œï¼Œç¥¨è­‰é–‹ç™¼äººå“¡å°±èƒ½è®“æ›´å¤šç¥¨è­‰é¡åˆ¥åœ¨å•†å®¶çš„æ„Ÿæ‡‰å¼åˆ·å¡æ©Ÿå…Œæ›ã€‚å¦‚è¦æ–°å¢ç¥¨è­‰é¡åˆ¥çš„æ”¯æ´ï¼Œæ‚¨ä¸éœ€è¦é€²è¡Œé¡å¤–çš„çµ‚ç«¯æ©Ÿè¨­å®šã€‚

## Pass configuration (ç¥¨è­‰è¨­å®š)

### Pass class configuration (ç¥¨è­‰é¡åˆ¥è¨­å®š)

æ‚¨å¿…é ˆåœ¨ç¥¨è­‰é¡åˆ¥ä¸Šè¨­å®šä¸‹åˆ—å±¬æ€§ï¼š

- `enableSmartTap` è¨­ç‚º True
- `redemptionIssuers` è¨­ç‚ºå°‡é€é Smart Tap å…Œæ›èˆ‡é€™å€‹é¡åˆ¥ç›¸é—œè¯çš„ç¥¨è­‰ç‰©ä»¶

```javascript
const { GoogleAuth } = require("google-auth-library");

// TODO: Define issuer ID
let issuerId = "Your issuer ID";
let classSuffix = "Your classSuffix";
const classId = `${issuerId}.${classSuffix}`;
const keyFilePath =
  process.env.GOOGLE_APPLICATION_CREDENTIALS || "/path/to/key.json";

const baseUrl = "https://walletobjects.googleapis.com/walletobjects/v1";

const credentials = require(keyFilePath);

const httpClient = new GoogleAuth({
  credentials: credentials,
  scopes: "https://www.googleapis.com/auth/wallet_object.issuer",
});

// Create a Loyalty SmartTap pass class
let loyaltyClass = {
  id: `${classId}`,
  issuerName: "Climax technology",
  programName: "Climax Loyalty SmartTap 2 Program Test",
  enableSmartTap: true, // Enable Smart Tap
  redemptionIssuers: [
    // Add any Redemption Issuer IDs
    "Your Redemption issuer ID",
  ],
  reviewStatus: "underReview",
  programLogo: {
    sourceUri: {
      uri: "https://www.sourcesecurity.com/img/companies/300/climax-logo_1560425415.jpg",
    },
    contentDescription: {
      defaultValue: {
        language: "en-US",
        value: "Program Logo",
      },
    },
  },
  textModulesData: [
    {
      header: "Welcome to Your Loyalty SmartTap 2 Program",
      body: "Thank you for joining our loyalty SmartTap 2 program. Enjoy exclusive rewards and benefits.",
      id: "welcome_message",
    },
  ],
  linksModuleData: {
    uris: [
      {
        uri: "https://www.climax.com.tw/",
        description: "Visit our loyalty SmartTap 2 program",
        id: "website",
      },
    ],
  },
  imageModulesData: [
    {
      mainImage: {
        sourceUri: {
          uri: "https://www.sourcesecurity.com/img/companies/300/climax-logo_1560425415.jpg",
        },
        contentDescription: {
          defaultValue: {
            language: "en-US",
            value: "Loyalty SmartTap 2 Program Banner",
          },
        },
      },
      id: "loyalty_banner",
    },
  ],
  messages: [
    {
      header: "Welcome",
      body: "Thanks for joining our loyalty SmartTap 2 program!",
      id: "welcome_message",
    },
  ],
};

// Check if the class exists already
httpClient
  .request({
    url: `${baseUrl}/loyaltyClass/${classId}`,
    method: "GET",
  })
  .then((response) => {
    console.log("Class already exists");
    console.log(response);

    console.log("Class ID");
    console.log(response.data.id);
  })
  .catch((err) => {
    if (err.response && err.response.status === 404) {
      // Class does not exist
      // Create it now
      httpClient
        .request({
          url: `${baseUrl}/loyaltyClass`,
          method: "POST",
          data: loyaltyClass,
        })
        .then((response) => {
          console.log("Class insert response");
          console.log(response);

          console.log("Class ID");
          console.log(response.data.id);
        });
    } else {
      // Something else went wrong
      console.log(err);
    }
  });
```

### Pass object configuration (ç¥¨è­‰ç‰©ä»¶è¨­å®š)

è‹¥æ˜¯å‚³éç‰©ä»¶ï¼Œå‰‡å¿…é ˆè¨­å®š `smartTapRedemptionValue` ã€‚

```javascript
const { GoogleAuth } = require("google-auth-library");
const jwt = require("jsonwebtoken");

// TODO: Define issuer ID
let issuerId = "Your issuer ID";
let classSuffix = "Your classSuffix"; // Use the loyalty class ID
let objectSuffix = "Your objectSuffix";
const objectId = `${issuerId}.${objectSuffix}`;
const keyFilePath =
  process.env.GOOGLE_APPLICATION_CREDENTIALS || "/path/to/key.json";

const baseUrl = "https://walletobjects.googleapis.com/walletobjects/v1";

const credentials = require(keyFilePath);

const httpClient = new GoogleAuth({
  credentials: credentials,
  scopes: "https://www.googleapis.com/auth/wallet_object.issuer",
});

// Create a Loyalty SmartTap pass object with Smart Tap support
let loyaltyObject = {
  id: `${objectId}`,
  classId: `${issuerId}.${classSuffix}`,
  state: "active",
  accountId: "123",
  accountName: "Nick Huang",
  textModulesData: [
    {
      header: "Your Loyalty Points",
      body: "You have 500 points.",
      id: "loyalty_points",
    },
  ],
  locations: [
    {
      latitude: 37.422,
      longitude: -122.084,
    },
  ],
  smartTapRedemptionValue: "500",
  infoModuleData: {
    labelValueRows: [
      {
        columns: [
          {
            label: "Smart Tap ID",
            value: "1234567890",
          },
        ],
      },
    ],
  },
};

// Check if the object exists already
httpClient
  .request({
    url: `${baseUrl}/loyaltyObject/${objectId}`,
    method: "GET",
  })
  .then((response) => {
    console.log("Object already exists");
    console.log(response);

    console.log("Object ID");
    console.log(response.data.id);
  })
  .catch((err) => {
    if (err.response && err.response.status === 404) {
      // Object does not exist
      // Create it now
      httpClient
        .request({
          url: `${baseUrl}/loyaltyObject`,
          method: "POST",
          data: loyaltyObject,
        })
        .then((response) => {
          console.log("Object insert response");
          console.log(response);

          console.log("Object ID");
          console.log(response.data.id);

          // Generate the "Add to Google Wallet" link
          generateAddToWalletLink(objectId);
        });
    } else {
      // Something else went wrong
      console.log(err);
    }
  });

function generateAddToWalletLink(objectId) {
  const payload = {
    iss: credentials.client_email, // `client_email` in service account file.
    aud: "google",
    origins: ["http://localhost:3000"],
    typ: "savetowallet",
    payload: {
      loyaltyObjects: [
        {
          id: objectId,
        },
      ],
    },
  };

  const token = jwt.sign(payload, credentials.private_key, {
    algorithm: "RS256",
  });
  const addToWalletLink = `https://pay.google.com/gp/v/save/${token}`;

  console.log("Add to Google Wallet link:");
  console.log(addToWalletLink);
}
```

åŸ·è¡Œå®Œæˆæœƒå¾—åˆ°ä¸€çµ„ JWTï¼Œåœ¨ç¶²é ä¸Šå¡«å…¥ https://pay.google.com/gp/v/save/{JWT} å³å¯å°‡å¡åˆ¸åŠ å…¥ä½ çš„ Google account ä¸­

## å±•ç¤º

ä¸‹è¼‰ [Smart tap sample app](https://github.com/google-wallet/smart-tap-sample-app)ï¼Œä¸¦å°‡ sample code ä¸­çš„ Collector ID æ”¹ç‚ºè‡ªå·±çš„ Collector ID ç•¶æˆåˆ·å¡æ©Ÿï¼

![google_wallet_smart_tap_result1]({{ site.baseurl }}/assets/images/google_wallet_smart_tap_result1.png)

![google_wallet_smart_tap_result2]({{ site.baseurl }}/assets/images/google_wallet_smart_tap_result2.png)

![google_wallet_smart_tap_result3]({{ site.baseurl }}/assets/images/google_wallet_smart_tap_result3.png)

## åƒè€ƒ

- [Smart Tap overview](https://developers.google.com/wallet/smart-tap/introduction/overview)
- [Smart tap sample app](https://github.com/google-wallet/smart-tap-sample-app)
- [Google Pay & Wallet Console](https://pay.google.com/business/console/home)
- [Create passes on Android using the Google Wallet API](https://codelabs.developers.google.com/add-to-wallet-android#1)
- [Create passes on Web using the Google Wallet API](https://codelabs.developers.google.com/add-to-wallet-web#1)

**Note:** å¦‚æœæœ‰ä»»ä½•å»ºè­°ã€å•é¡Œæˆ–ä¸åŒæƒ³æ³•ï¼Œæ­¡è¿ç•™è¨€æˆ–å¯„ä¿¡çµ¦æˆ‘ï¼Œå¯ä»¥ä¸€èµ·è¨è«–é€²æ­¥æˆé•· ğŸ™‚
{: .notice--success}
