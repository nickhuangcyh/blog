<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.4.1">Jekyll</generator><link href="https://nickhuangcyh.github.io/blog/feed.xml" rel="self" type="application/atom+xml" /><link href="https://nickhuangcyh.github.io/blog/" rel="alternate" type="text/html" /><updated>2025-05-11T07:37:23+00:00</updated><id>https://nickhuangcyh.github.io/blog/feed.xml</id><title type="html">Nickâ€™s Blog</title><subtitle>An amazing website.</subtitle><author><name>Nick Huang</name></author><entry><title type="html">ğŸš€ å¦‚ä½•ä½¿ç”¨ Excalidraw AI å¿«é€Ÿç”Ÿæˆå°ˆæ¥­ç´šåœ–è¡¨ï¼Œæå‡å·¥ä½œæ•ˆç‡ï¼</title><link href="https://nickhuangcyh.github.io/blog/ai%20tools/visualization/productivity/ai-tools-excalidraw-chart-guide/" rel="alternate" type="text/html" title="ğŸš€ å¦‚ä½•ä½¿ç”¨ Excalidraw AI å¿«é€Ÿç”Ÿæˆå°ˆæ¥­ç´šåœ–è¡¨ï¼Œæå‡å·¥ä½œæ•ˆç‡ï¼" /><published>2025-03-15T08:30:00+00:00</published><updated>2025-03-15T08:30:00+00:00</updated><id>https://nickhuangcyh.github.io/blog/ai%20tools/visualization/productivity/ai-tools-excalidraw-chart-guide</id><content type="html" xml:base="https://nickhuangcyh.github.io/blog/ai%20tools/visualization/productivity/ai-tools-excalidraw-chart-guide/"><![CDATA[<h2 id="-å‰è¨€">ğŸ“¢ <strong>å‰è¨€</strong></h2>

<p>åœ¨ç¾ä»£å·¥ä½œä¸­ï¼Œç„¡è«–æ˜¯ <strong>å·¥ç¨‹å¸«ã€è¨­è¨ˆå¸«ã€å•†æ¥­åˆ†æå¸«é‚„æ˜¯æ•™è‚²å·¥ä½œè€…</strong>ï¼Œéƒ½éœ€è¦è£½ä½œåœ–è¡¨ä¾†è¦–è¦ºåŒ–è³‡è¨Šã€‚ç„¶è€Œï¼Œå‚³çµ±çš„ç¹ªåœ–å·¥å…·é€šå¸¸éœ€è¦æ‰‹å‹•æ‹–æ‹‰å…ƒä»¶ã€èª¿æ•´ç·šæ¢ï¼Œæ—¢è€—æ™‚åˆç¹ç‘£ã€‚</p>

<p>ç¾åœ¨ï¼Œé€é <strong>Excalidraw AI</strong>ï¼Œæˆ‘å€‘å¯ä»¥é€éç°¡å–®çš„æ–‡å­—æè¿°ï¼Œè‡ªå‹•ç”Ÿæˆ <strong>æµç¨‹åœ–ã€å¿ƒæ™ºåœ–ã€æŠ€è¡“æ¶æ§‹åœ–ã€å•†æ¥­æµç¨‹åœ–</strong> ç­‰ï¼Œå¤§å¹…æé«˜å·¥ä½œæ•ˆç‡ï¼</p>

<p>æœ¬æ–‡å°‡ä»‹ç´¹ Excalidraw AI çš„å¼·å¤§åŠŸèƒ½ï¼Œä¸¦é€éä¸€å€‹ <strong>MQTT é€šè¨Šå”å®šæµç¨‹åœ–</strong>ï¼Œå±•ç¤ºå¦‚ä½•å¿«é€Ÿç”Ÿæˆå°ˆæ¥­ç´šåœ–è¡¨ã€‚</p>

<hr />

<h2 id="-ç‚ºä»€éº¼é¸æ“‡-excalidraw-ai">ğŸ¯ <strong>ç‚ºä»€éº¼é¸æ“‡ Excalidraw AIï¼Ÿ</strong></h2>

<p><strong>Excalidraw</strong> æ˜¯ä¸€æ¬¾é–‹æºçš„ <strong>æ‰‹ç¹ªé¢¨æ ¼ç¹ªåœ–å·¥å…·</strong>ï¼Œè€Œ <strong>Excalidraw AI</strong> å‰‡åŠ å…¥äº† <strong>AI è‡ªå‹•ç¹ªåœ–åŠŸèƒ½</strong>ï¼Œåªéœ€è¼¸å…¥ç°¡å–®çš„æ–‡å­—æè¿°ï¼Œå®ƒå°±èƒ½æ™ºèƒ½è­˜åˆ¥å…§å®¹ä¸¦è‡ªå‹•ç”Ÿæˆåœ–è¡¨ã€‚</p>

<h3 id="-excalidraw-ai-çš„ä¸»è¦å„ªå‹¢">âœ… <strong>Excalidraw AI çš„ä¸»è¦å„ªå‹¢</strong></h3>

<ul>
  <li><strong>ğŸš€ å¿«é€Ÿç”Ÿæˆåœ–è¡¨</strong>ï¼šç„¡éœ€æ‰‹å‹•ç¹ªè£½ï¼Œåªéœ€è¼¸å…¥æè¿°ï¼Œå³å¯ç²å¾—å®Œæ•´åœ–è¡¨ã€‚</li>
  <li><strong>ğŸ“Š æ”¯æ´å¤šç¨®åœ–è¡¨é¡å‹</strong>ï¼šæµç¨‹åœ–ã€å¿ƒæ™ºåœ–ã€æŠ€è¡“æ¶æ§‹åœ–ã€å•†æ¥­åœ–è¡¨ç­‰æ‡‰æœ‰ç›¡æœ‰ã€‚</li>
  <li><strong>âœï¸ å¯ç·¨è¼¯èˆ‡è‡ªè¨‚</strong>ï¼šç”Ÿæˆå¾Œçš„åœ–è¡¨ä»ç„¶å¯ä»¥æ‰‹å‹•èª¿æ•´ï¼Œç¬¦åˆå€‹äººéœ€æ±‚ã€‚</li>
  <li><strong>ğŸ†“ é–‹æºä¸”å…è²»</strong>ï¼šå¯ç›´æ¥åœ¨ç·šä½¿ç”¨ï¼Œç„¡éœ€å®‰è£é¡å¤–è»Ÿé«”ã€‚</li>
</ul>

<hr />

<h2 id="-å¦‚ä½•ä½¿ç”¨-excalidraw-ai-ç”Ÿæˆå°ˆæ¥­ç´šåœ–è¡¨">ğŸ›  <strong>å¦‚ä½•ä½¿ç”¨ Excalidraw AI ç”Ÿæˆå°ˆæ¥­ç´šåœ–è¡¨ï¼Ÿ</strong></h2>

<h3 id="1ï¸âƒ£-é€²å…¥-excalidraw-ai">1ï¸âƒ£ <strong>é€²å…¥ Excalidraw AI</strong></h3>

<p>é¦–å…ˆï¼Œæ‰“é–‹ <strong><a href="https://excalidraw.com/">Excalidraw AI å®˜æ–¹ç¶²ç«™</a></strong>ã€‚
é¸å–å³ä¸Šè§’ <code class="language-plaintext highlighter-rouge">æ›´å¤šå·¥å…·</code> -&gt; <code class="language-plaintext highlighter-rouge">æ–‡å­—è½‰åœ–è¡¨ AI</code></p>

<p><img src="/blog/assets/images/ai_tools_excalidraw_1.png" alt="ai_tools_excalidraw_1" /></p>

<h3 id="2ï¸âƒ£-è¼¸å…¥æ–‡å­—æè¿°">2ï¸âƒ£ <strong>è¼¸å…¥æ–‡å­—æè¿°</strong></h3>

<p>åœ¨æ–‡å­—è¼¸å…¥æ¡†å…§ï¼Œè¼¸å…¥ä»¥ä¸‹æè¿°ä¾†ç”Ÿæˆä¸€å€‹ <strong>MQTT é€šè¨Šå”å®šæµç¨‹åœ–</strong>ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Title: Client-Client Communication via Server
1. Phone and Device connect to the MQTT Broker
    * Both connect to the same MQTT Broker.
2. Phone subscribes to the Device's status topic
    * Phone subscribes to Device's status (e.g., smartlight/status).
3. Device reports its status
    * Device publishes its status (e.g., light on/off) to the topic.
4. Phone receives status updates
    * Phone receives and updates the status (e.g., light turned on/off).
5. Phone sends control commands to Device
    * Phone sends control commands (e.g., turn on/off) to the topic.
6. Device executes commands and updates status
    * Device executes the command and updates the status.
7. Phone receives the new status and updates UI
    * Phone receives new status and updates the interface.
8. Device sends a Last Will and Testament (LWT) message if it disconnects
    * If Device disconnects, an LWT message (e.g., "status": "offline") is sent.
9. Phone disconnects from the Broker
    * Phone disconnects after completing the tasks.
</code></pre></div></div>

<p><img src="/blog/assets/images/ai_tools_excalidraw_2.png" alt="ai_tools_excalidraw_2" /></p>

<h3 id="3ï¸âƒ£-ai-è‡ªå‹•ç”Ÿæˆåœ–è¡¨">3ï¸âƒ£ <strong>AI è‡ªå‹•ç”Ÿæˆåœ–è¡¨</strong></h3>

<p>Excalidraw AI æœƒæ ¹æ“šä½ çš„æè¿°ï¼Œè‡ªå‹•ç”Ÿæˆå°æ‡‰çš„æµç¨‹åœ–ï¼Œä½ å¯ä»¥é€²ä¸€æ­¥ <strong>èª¿æ•´ç¯€é»ã€ç·šæ¢</strong>ï¼Œä½¿å…¶æ›´åŠ æ¸…æ™°ã€‚</p>

<p><img src="/blog/assets/images/ai_tools_excalidraw_3.jpg" alt="ai_tools_excalidraw_3" /></p>

<hr />

<h2 id="-excalidraw-ai-çš„æ‡‰ç”¨å ´æ™¯">ğŸ¯ <strong>Excalidraw AI çš„æ‡‰ç”¨å ´æ™¯</strong></h2>

<h3 id="-å·¥ç¨‹èˆ‡æŠ€è¡“é ˜åŸŸ">ğŸ‘¨â€ğŸ’» <strong>å·¥ç¨‹èˆ‡æŠ€è¡“é ˜åŸŸ</strong></h3>

<ul>
  <li><strong>æŠ€è¡“æ¶æ§‹åœ–</strong>ï¼šå¿«é€Ÿç¹ªè£½ API äº¤äº’ã€ç³»çµ±æ¶æ§‹ã€æ•¸æ“šæµåœ–ã€‚</li>
  <li><strong>ç¶²çµ¡é€šè¨Šæµç¨‹åœ–</strong>ï¼šå±•ç¤ºä¼ºæœå™¨ã€å®¢æˆ¶ç«¯ã€å”è­°æ•¸æ“šäº¤æ›ç­‰ã€‚</li>
</ul>

<h3 id="-è¨­è¨ˆèˆ‡å‰µæ„é ˜åŸŸ">ğŸ¨ <strong>è¨­è¨ˆèˆ‡å‰µæ„é ˜åŸŸ</strong></h3>

<ul>
  <li><strong>æ‰‹ç¹ªé¢¨åœ–è¡¨</strong>ï¼šé©åˆè¨­è¨ˆå¸«ã€å‰µæ„å·¥ä½œè€…è£½ä½œå…·è‰åœ–é¢¨æ ¼çš„åœ–å½¢ã€‚</li>
  <li><strong>ä»‹é¢æµç¨‹åœ–</strong>ï¼šè¨­è¨ˆç”¢å“ UX æµç¨‹ï¼Œå„ªåŒ–ä½¿ç”¨è€…é«”é©—ã€‚</li>
</ul>

<h3 id="-å•†æ¥­èˆ‡ç­–ç•¥é ˜åŸŸ">ğŸ“Š <strong>å•†æ¥­èˆ‡ç­–ç•¥é ˜åŸŸ</strong></h3>

<ul>
  <li><strong>å•†æ¥­æµç¨‹åœ–</strong>ï¼šä¼æ¥­ç®¡ç†äººå“¡å¯ç”¨ä¾†è¦åŠƒå·¥ä½œæµç¨‹ã€æ¥­å‹™é‹ä½œã€‚</li>
  <li><strong>å°ˆæ¡ˆç®¡ç†è¦–è¦ºåœ–</strong>ï¼šè¦–è¦ºåŒ–å°ˆæ¡ˆè¦åŠƒï¼Œæå‡åœ˜éšŠæºé€šæ•ˆç‡ã€‚</li>
</ul>

<h3 id="-æ•™è‚²èˆ‡å­¸ç¿’é ˜åŸŸ">ğŸ“š <strong>æ•™è‚²èˆ‡å­¸ç¿’é ˜åŸŸ</strong></h3>

<ul>
  <li><strong>å¿ƒæ™ºåœ–</strong>ï¼šå¹«åŠ©å­¸ç”Ÿã€ç ”ç©¶äººå“¡æ•´ç†æ€è·¯ï¼Œå¿«é€Ÿæ­å»ºæ¦‚å¿µçµæ§‹ã€‚</li>
  <li><strong>æ•™å­¸ç¤ºæ„åœ–</strong>ï¼šæ•™å¸«èˆ‡è¬›å¸«å¯åˆ©ç”¨å®ƒä¾†è¦–è¦ºåŒ–å„ç¨®çŸ¥è­˜é»ï¼Œæé«˜å­¸ç¿’æ•ˆæœã€‚</li>
</ul>

<hr />

<h2 id="-ai-ç¹ªåœ–å·¥å…·å¦‚ä½•æå‡ä½ çš„å·¥ä½œæ•ˆç‡">âš¡ <strong>AI ç¹ªåœ–å·¥å…·å¦‚ä½•æå‡ä½ çš„å·¥ä½œæ•ˆç‡ï¼Ÿ</strong></h2>

<ul>
  <li><strong>ğŸš€ çœæ™‚çœåŠ›</strong>ï¼šæ¯”èµ·å‚³çµ±æ‰‹å‹•ç¹ªè£½ï¼ŒAI åªéœ€æ•¸ç§’å°±èƒ½ç”Ÿæˆå®Œæ•´åœ–è¡¨ã€‚</li>
  <li><strong>ğŸ–¥ ç„¡ç—›ä¿®æ”¹</strong>ï¼šAI ç”Ÿæˆå¾Œçš„åœ–è¡¨ä»å¯æ‰‹å‹•å¾®èª¿ï¼Œç¢ºä¿ç¬¦åˆéœ€æ±‚ã€‚</li>
  <li><strong>ğŸ“ˆ æé«˜å°ˆæ¥­åº¦</strong>ï¼šæŠ€è¡“æ–‡ä»¶ã€å•†æ¥­ç°¡å ±ã€æ•™å­¸å…§å®¹çš„è¦–è¦ºæ•ˆæœç¬é–“æå‡ã€‚</li>
  <li><strong>ğŸ†“ å…è²»ä½¿ç”¨</strong>ï¼šç„¡éœ€é¡å¤–è³¼è²·è»Ÿé«”ï¼Œé–‹æºå·¥å…· Excalidraw è®“æ¯å€‹äººéƒ½èƒ½è¼•é¬†ä½¿ç”¨ã€‚</li>
</ul>

<hr />

<h2 id="-çµè«–">ğŸ”¥ <strong>çµè«–</strong></h2>

<p>é€é <strong>Excalidraw AI</strong>ï¼Œä¸åƒ… <strong>å·¥ç¨‹å¸«</strong> å¯ä»¥å¿«é€Ÿå°‡ <strong>æŠ€è¡“æ¶æ§‹ã€é€šè¨Šå”è­°ã€æ•¸æ“šæµè¨­è¨ˆ</strong> è½‰æ›ç‚ºè¦–è¦ºåŒ–åœ–è¡¨ï¼Œ<strong>è¨­è¨ˆå¸«ã€æ•™å¸«ã€å•†æ¥­åˆ†æå¸«</strong> ä¹Ÿèƒ½åˆ©ç”¨å®ƒä¾† <strong>å‰µå»ºæ‰‹ç¹ªé¢¨åœ–è¡¨ã€å¿ƒæ™ºåœ–ã€å•†æ¥­æµç¨‹åœ–</strong>ï¼Œæ¥µå¤§æå‡å‰µä½œèˆ‡æºé€šæ•ˆç‡ã€‚</p>

<p>å¦‚æœä½ ç¶“å¸¸éœ€è¦è£½ä½œå„é¡è¦–è¦ºåŒ–åœ–è¡¨ï¼Œä¸å¦¨è©¦è©¦ <strong>Excalidraw AI</strong>ï¼Œè®“ AI å¹«ä½ å®Œæˆç¹ç‘£çš„åœ–è¡¨ç¹ªè£½å·¥ä½œï¼Œè®“ä½ çš„å°ˆæ¡ˆæ›´é«˜æ•ˆã€æ›´å°ˆæ¥­ï¼</p>

<hr />

<p>ğŸ”— <strong>å»¶ä¼¸é–±è®€</strong></p>

<ul>
  <li><a href="https://excalidraw.com/">Excalidraw å®˜æ–¹ç¶²ç«™</a></li>
  <li><a href="https://github.com/excalidraw/excalidraw">Excalidraw AI GitHub å°ˆæ¡ˆ</a></li>
</ul>]]></content><author><name>Nick Huang</name></author><category term="AI Tools" /><category term="Visualization" /><category term="Productivity" /><category term="Excalidraw" /><category term="AI Drawing" /><category term="Diagram Tool" /><category term="Flowchart" /><category term="Mind Map" /><summary type="html"><![CDATA[ä½¿ç”¨ Excalidraw AI åªéœ€è¼¸å…¥æ–‡å­—æè¿°ï¼Œå³å¯å¿«é€Ÿç”Ÿæˆæµç¨‹åœ–ã€æŠ€è¡“æ¶æ§‹åœ–ã€å¿ƒæ™ºåœ–ç­‰ï¼Œæå‡å·¥ä½œæ•ˆç‡ï¼]]></summary></entry><entry><title type="html">Setup Development Environment on a New macOS</title><link href="https://nickhuangcyh.github.io/blog/setup%20guide/setup-development-environment-on-a-new-macos/" rel="alternate" type="text/html" title="Setup Development Environment on a New macOS" /><published>2025-01-11T07:00:00+00:00</published><updated>2025-01-11T07:00:00+00:00</updated><id>https://nickhuangcyh.github.io/blog/setup%20guide/setup-development-environment-on-a-new-macos</id><content type="html" xml:base="https://nickhuangcyh.github.io/blog/setup%20guide/setup-development-environment-on-a-new-macos/"><![CDATA[<h1 id="setup-development-environment-on-a-new-macos">Setup Development Environment on a New macOS</h1>

<h2 id="install-homebrew">Install <a href="https://brew.sh/index_zh-tw">Homebrew</a></h2>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/bin/bash <span class="nt">-c</span> <span class="s2">"</span><span class="si">$(</span>curl <span class="nt">-fsSL</span> https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh<span class="si">)</span><span class="s2">"</span>
</code></pre></div></div>

<h3 id="common-issue">Common Issue</h3>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Warning: /opt/homebrew/bin is not <span class="k">in </span>your PATH
</code></pre></div></div>

<p>To resolve this, add Homebrewâ€™s bin directory to your PATH:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim ~/.zshrc
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>/opt/homebrew/bin:<span class="nv">$PATH</span>
:wq
<span class="nb">source</span> ~/.zshrc
</code></pre></div></div>

<p>Refer to <a href="https://stackoverflow.com/questions/65487249/getting-a-warning-when-installing-homebrew-on-macos-big-sur-m1-chip">this StackOverflow thread</a> for more details.</p>

<h2 id="install-git">Install Git</h2>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>git
</code></pre></div></div>

<h3 id="setup-git-email--name"><a href="https://stackoverflow.com/questions/46941346/how-to-know-the-git-username-and-email-saved-during-configuration/53940971">Setup Git Email &amp; Name</a></h3>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config <span class="nt">--global</span> user.email <span class="s2">"you@example.com"</span>
git config <span class="nt">--global</span> user.name <span class="s2">"Your Name"</span>
</code></pre></div></div>

<h3 id="setup-git-alias"><a href="https://stackoverflow.com/questions/2553786/how-do-i-alias-commands-in-git">Setup Git Alias</a></h3>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config <span class="nt">--global</span> alias.co checkout
git config <span class="nt">--global</span> alias.ci commit
git config <span class="nt">--global</span> alias.st status
git config <span class="nt">--global</span> alias.br branch
</code></pre></div></div>

<h2 id="install-iterm2">Install <a href="https://formulae.brew.sh/cask/iterm2">iTerm2</a></h2>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew tap homebrew/cask
brew <span class="nb">install</span> <span class="nt">--cask</span> iterm2
</code></pre></div></div>

<p>Switch from the default Terminal to iTerm2.</p>

<h2 id="iterm2--zsh-setup">iTerm2 + Zsh Setup</h2>

<h3 id="install-zsh">Install <a href="https://formulae.brew.sh/formula/zsh#default">Zsh</a></h3>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>zsh
</code></pre></div></div>

<h3 id="install-oh-my-zsh">Install <a href="https://ohmyz.sh/#install">Oh-My-Zsh</a></h3>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sh <span class="nt">-c</span> <span class="s2">"</span><span class="si">$(</span>curl <span class="nt">-fsSL</span> https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh<span class="si">)</span><span class="s2">"</span>
</code></pre></div></div>

<h3 id="setup-colors">Setup Colors</h3>

<p>Navigate to Preferences -&gt; Profiles -&gt; Colors -&gt; Select â€˜Solarizedâ€™.</p>

<h3 id="install-fonts">Install Fonts</h3>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew tap homebrew/cask-fonts
brew search font-meslo-lg-nerd-font
brew <span class="nb">install</span> <span class="nt">--cask</span> font-meslo-lg-nerd-font
</code></pre></div></div>

<p>Set your terminal font to <code class="language-plaintext highlighter-rouge">font-meslo-lg-nerd-font</code> in Preferences.</p>

<h3 id="install-powerlevel10k-theme">Install <a href="https://github.com/romkatv/powerlevel10k">Powerlevel10k</a> Theme</h3>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone <span class="nt">--depth</span><span class="o">=</span>1 https://github.com/romkatv/powerlevel10k.git <span class="k">${</span><span class="nv">ZSH_CUSTOM</span><span class="k">:-</span><span class="nv">$HOME</span><span class="p">/.oh-my-zsh/custom</span><span class="k">}</span>/themes/powerlevel10k
</code></pre></div></div>

<p>Update your <code class="language-plaintext highlighter-rouge">~/.zshrc</code> to use Powerlevel10k:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">ZSH_THEME</span><span class="o">=</span><span class="s2">"powerlevel10k/powerlevel10k"</span>
</code></pre></div></div>

<p>Run the following to configure the theme:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p10k configure
</code></pre></div></div>

<h3 id="install-zsh-syntax-highlighting">Install <a href="https://github.com/zsh-users/zsh-syntax-highlighting">Zsh-Syntax-Highlighting</a></h3>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/zsh-users/zsh-syntax-highlighting.git <span class="k">${</span><span class="nv">ZSH_CUSTOM</span><span class="k">:-</span><span class="p">~/.oh-my-zsh/custom</span><span class="k">}</span>/plugins/zsh-syntax-highlighting
</code></pre></div></div>

<p>Activate the plugin in <code class="language-plaintext highlighter-rouge">~/.zshrc</code>:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">plugins</span><span class="o">=(</span>... zsh-syntax-highlighting<span class="o">)</span>
</code></pre></div></div>

<h3 id="install-zsh-autosuggestions">Install <a href="https://github.com/zsh-users/zsh-autosuggestions">Zsh-Autosuggestions</a></h3>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/zsh-users/zsh-autosuggestions <span class="k">${</span><span class="nv">ZSH_CUSTOM</span><span class="k">:-</span><span class="p">~/.oh-my-zsh/custom</span><span class="k">}</span>/plugins/zsh-autosuggestions
</code></pre></div></div>

<p>Activate the plugin in <code class="language-plaintext highlighter-rouge">~/.zshrc</code>:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">plugins</span><span class="o">=(</span>... zsh-autosuggestions<span class="o">)</span>
</code></pre></div></div>

<p>Restart your terminal to apply changes.</p>

<h2 id="ios-environment-install-xcode">iOS Environment: Install Xcode</h2>

<h3 id="install-xcodes-tool">Install Xcodes Tool</h3>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>robotsandpencils/made/xcodes
</code></pre></div></div>

<h3 id="common-issue-1">Common Issue</h3>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>error: terminated<span class="o">(</span>72<span class="o">)</span>: /usr/bin/xcrun <span class="nt">--sdk</span> macosx <span class="nt">--find</span> xctest output:
    xcrun: error: unable to find utility <span class="s2">"xctest"</span>, not a developer tool or <span class="k">in </span>PATH
</code></pre></div></div>

<p>Refer to <a href="https://github.com/RobotsAndPencils/xcodes/issues/148">this GitHub issue</a> for resolution.</p>

<h3 id="alternative-use-xcodesapp">Alternative: Use XcodesApp</h3>

<p>If issues persist, download Xcode via the <a href="https://apps.apple.com/">App Store</a>.</p>

<h2 id="install-jetbrains-toolbox">Install JetBrains Toolbox</h2>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install</span> <span class="nt">--cask</span> jetbrains-toolbox
</code></pre></div></div>

<p>Use JetBrains Toolbox to manage IDEs like Android Studio, IntelliJ IDEA, and PyCharm.</p>

<h2 id="install-openjdk">Install OpenJDK</h2>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>openjdk@11
</code></pre></div></div>

<p>Add OpenJDK to your PATH:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s1">'export PATH="/opt/homebrew/opt/openjdk@11/bin:$PATH"'</span> <span class="o">&gt;&gt;</span> ~/.zshrc
</code></pre></div></div>

<p>For compilers, set:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">CPPFLAGS</span><span class="o">=</span><span class="s2">"-I/opt/homebrew/opt/openjdk@11/include"</span>
</code></pre></div></div>

<h2 id="ssh-key-setup">SSH Key Setup</h2>

<p>Create unique keys for each platform (e.g., GitHub, GitLab).</p>

<h3 id="github">GitHub</h3>

<p>Follow <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent">GitHubâ€™s guide</a>.</p>

<h3 id="gitlab">GitLab</h3>

<p>Follow <a href="http://10.1.2.150:53180/help/ssh/README">GitLabâ€™s SSH setup guide</a>.</p>

<h2 id="android-build-issue">Android Build Issue</h2>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Caused by: java.lang.Exception: No native library is found <span class="k">for </span>os.name<span class="o">=</span>Mac and os.arch<span class="o">=</span>aarch64. <span class="nv">path</span><span class="o">=</span>/org/sqlite/native/Mac/aarch64
</code></pre></div></div>

<p>Refer to <a href="https://stackoverflow.com/questions/68884589/caused-by-java-lang-exception-no-native-library-is-found-for-os-name-mac-and-o">this StackOverflow solution</a>.</p>

<hr />

<p>ğŸ‰ Your macOS development environment setup is complete!</p>]]></content><author><name>Nick Huang</name></author><category term="Setup Guide" /><category term="macOS" /><category term="Development" /><category term="Mobile Development" /><summary type="html"><![CDATA[Step-by-step guide to setting up a mobile development environment on a new macOS system.]]></summary></entry><entry><title type="html">Design Pattern (28) - Interpreter Pattern (è§£è­¯å™¨æ¨¡å¼)</title><link href="https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-28-interpreter-pattern/" rel="alternate" type="text/html" title="Design Pattern (28) - Interpreter Pattern (è§£è­¯å™¨æ¨¡å¼)" /><published>2024-12-29T08:30:00+00:00</published><updated>2024-12-29T08:30:00+00:00</updated><id>https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-28-interpreter-pattern</id><content type="html" xml:base="https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-28-interpreter-pattern/"><![CDATA[<blockquote>
  <p>æ‚¨å¯æ–¼æ­¤ <a href="https://github.com/nickhuangcyh/design_pattern">design_pattern repo</a> ä¸‹è¼‰ Design Pattern ç³»åˆ—ç¨‹å¼ç¢¼ã€‚</p>
</blockquote>

<hr />

<h2 id="éœ€æ±‚">éœ€æ±‚</h2>

<p>æˆ‘å€‘éœ€è¦è¨­è¨ˆä¸€å€‹å¸ƒæ—é‹ç®—è§£è­¯ç³»çµ±ï¼Œå…·å‚™ä»¥ä¸‹åŠŸèƒ½ï¼š</p>

<ol>
  <li>èƒ½è§£è­¯åŒ…å«å¸ƒæ—å€¼ã€AND é‹ç®—èˆ‡ OR é‹ç®—çš„è¡¨é”å¼ã€‚</li>
  <li>ç¬¦åˆé–‹æ”¾é—œé–‰åŸå‰‡ï¼Œèƒ½å¤ æ–¹ä¾¿åœ°æ–°å¢å…¶ä»–é‹ç®—ï¼ˆå¦‚ NOTï¼‰ã€‚</li>
  <li>ç³»çµ±çµæ§‹æ¸…æ™°ï¼Œæ˜“æ–¼ç¶­è­·èˆ‡æ“´å±•ã€‚</li>
</ol>

<hr />

<h2 id="ç‰©ä»¶å°å‘åˆ†æ-ooa">ç‰©ä»¶å°å‘åˆ†æ (OOA)</h2>

<p>ç†è§£éœ€æ±‚å¾Œï¼Œè®“æˆ‘å€‘ä¾†å¿«é€Ÿå¯¦ä½œç‰©ä»¶å°å‘åˆ†æå§ï¼</p>

<p><img src="/blog/assets/images/design_pattern_interpreter_pattern_uml_1.png" alt="interpreter_pattern_uml_1" /></p>

<h3 id="å¯Ÿè¦º-forces">å¯Ÿè¦º Forces</h3>

<ol>
  <li>
    <p><strong>è¤‡é›œæ€§å¢åŠ </strong></p>

    <ul>
      <li>éš¨è‘—é‹ç®—ç¬¦é¡å‹å¢åŠ ï¼Œæ‰‹å‹•è§£æé‚è¼¯æœƒè®Šå¾—é›£ä»¥ç¶­è­·ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>é‡è¤‡ä»£ç¢¼</strong></p>

    <ul>
      <li>ä¸åŒé‹ç®—ç¬¦çš„è™•ç†å¯èƒ½å°è‡´é¡ä¼¼åŠŸèƒ½é‡è¤‡å¯¦ç¾ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>é›£ä»¥æ“´å±•</strong></p>
    <ul>
      <li>æ–°å¢é‹ç®—ç¬¦éœ€è¦ä¿®æ”¹å¤§é‡ä»£ç¢¼ï¼Œé•åé–‹æ”¾é—œé–‰åŸå‰‡ (OCP)ã€‚</li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="å¥—ç”¨-interpreter-pattern-solution-å¾—åˆ°æ–°çš„-context-resulting-context">å¥—ç”¨ Interpreter Pattern (Solution) å¾—åˆ°æ–°çš„ Context (Resulting Context)</h2>

<p>åšå®Œ OOAï¼Œå¯Ÿè¦º Forcesï¼Œçœ‹æ¸…æ¥šæ•´å€‹ Context å¾Œï¼Œå°±å¯ä»¥ä¾†å¥—ç”¨ Interpreter Pattern è§£æ±ºé€™å€‹å•é¡Œã€‚</p>

<p>å…ˆä¾†çœ‹ä¸€ä¸‹ Interpreter Pattern çš„ UML</p>

<p><img src="/blog/assets/images/design_pattern_interpreter_pattern_uml_2.png" alt="interpreter_pattern_uml_2" /></p>

<h3 id="interrepter-pattern-çš„çµ„ä»¶">Interrepter Pattern çš„çµ„ä»¶</h3>

<ol>
  <li>
    <p><strong>å»ºç«‹æŠ½è±¡è¡¨é”å¼ (Expression)</strong></p>

    <ul>
      <li>å®šç¾©æ‰€æœ‰è¡¨é”å¼çš„é€šç”¨ä»‹é¢ï¼Œç¢ºä¿ä¸åŒé¡å‹çš„è¡¨é”å¼å¯ä»¥è¢«çµ±ä¸€è™•ç†ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>è¨­è¨ˆçµ‚ç«¯è¡¨é”å¼ (Terminal Expression)</strong></p>

    <ul>
      <li>è² è²¬è™•ç†èªæ³•ä¸­çš„åŸºæœ¬å–®ä½ï¼ˆå¦‚å¸ƒæ—å€¼ <code class="language-plaintext highlighter-rouge">true</code> å’Œ <code class="language-plaintext highlighter-rouge">false</code>ï¼‰ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>è¨­è¨ˆéçµ‚ç«¯è¡¨é”å¼ (Non-Terminal Expression)</strong></p>
    <ul>
      <li>è¡¨ç¤ºè¤‡é›œé‹ç®—çš„çµ„åˆï¼ˆå¦‚ <code class="language-plaintext highlighter-rouge">AND</code> å’Œ <code class="language-plaintext highlighter-rouge">OR</code>ï¼‰ï¼Œéè¿´è™•ç†å­è¡¨é”å¼ã€‚</li>
    </ul>
  </li>
</ol>

<p>ç‚ºäº†è§£æ±ºä¸Šè¿°å•é¡Œï¼Œæˆ‘å€‘æ¡ç”¨è§£è­¯å™¨æ¨¡å¼ä¾†å»ºæ§‹å¸ƒæ—é‹ç®—ç³»çµ±ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯å°‡æ¯å€‹é‹ç®—ç¬¦èˆ‡æ“ä½œæ•¸ä½œç‚ºä¸€å€‹ â€œè¡¨é”å¼â€ï¼Œä¸¦ä½¿ç”¨éè¿´çš„æ–¹å¼é€²è¡Œè§£è­¯ã€‚</p>

<p>é€éé€™ç¨®æ–¹å¼ï¼Œæˆ‘å€‘å¯ä»¥å°‡è¤‡é›œçš„å¸ƒæ—é‹ç®—æ‹†è§£ç‚ºå¤šå€‹å°å‹ä¸”å¯çµ„åˆçš„å–®å…ƒï¼Œä¸¦ä¿æŒç³»çµ±çµæ§‹çš„éˆæ´»æ€§ã€‚</p>

<p>å°‡ Interpreter Pattern å¥—ç”¨åˆ°æˆ‘å€‘çš„æ‡‰ç”¨å§</p>

<p><img src="/blog/assets/images/design_pattern_interpreter_pattern_uml_3.png" alt="interpreter_pattern_uml_3" /></p>

<hr />

<h2 id="ç‰©ä»¶å°å‘ç¨‹å¼è¨­è¨ˆ-oop">ç‰©ä»¶å°å‘ç¨‹å¼è¨­è¨ˆ (OOP)</h2>

<p>[æŠ½è±¡è¡¨é”å¼: Expression]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">Expression</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">interpret</span><span class="p">():</span> <span class="nc">Boolean</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[çµ‚ç«¯è¡¨é”å¼: BooleanValue]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">BooleanValue</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">value</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">)</span> <span class="p">:</span> <span class="nc">Expression</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">interpret</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">value</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[éçµ‚ç«¯è¡¨é”å¼: AndExpression, OrExpression]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">AndExpression</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">left</span><span class="p">:</span> <span class="nc">Expression</span><span class="p">,</span> <span class="k">private</span> <span class="kd">val</span> <span class="py">right</span><span class="p">:</span> <span class="nc">Expression</span><span class="p">)</span> <span class="p">:</span> <span class="nc">Expression</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">interpret</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">left</span><span class="p">.</span><span class="nf">interpret</span><span class="p">()</span> <span class="p">&amp;&amp;</span> <span class="n">right</span><span class="p">.</span><span class="nf">interpret</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">OrExpression</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">left</span><span class="p">:</span> <span class="nc">Expression</span><span class="p">,</span> <span class="k">private</span> <span class="kd">val</span> <span class="py">right</span><span class="p">:</span> <span class="nc">Expression</span><span class="p">)</span> <span class="p">:</span> <span class="nc">Expression</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">interpret</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">left</span><span class="p">.</span><span class="nf">interpret</span><span class="p">()</span> <span class="p">||</span> <span class="n">right</span><span class="p">.</span><span class="nf">interpret</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[å®¢æˆ¶ç«¯ä»£ç¢¼: Client]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// å®šç¾©å¸ƒæ—è¡¨é”å¼ï¼štrue AND false OR true</span>
    <span class="kd">val</span> <span class="py">expression</span> <span class="p">=</span> <span class="nc">OrExpression</span><span class="p">(</span>
        <span class="nc">AndExpression</span><span class="p">(</span>
            <span class="nc">BooleanValue</span><span class="p">(</span><span class="k">true</span><span class="p">),</span>
            <span class="nc">BooleanValue</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="nc">BooleanValue</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1">// è¨ˆç®—çµæœ</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="n">expression</span><span class="p">.</span><span class="nf">interpret</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Result of the expression is: $result"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[Output]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Result</span> <span class="n">of</span> <span class="n">the</span> <span class="n">expression</span> <span class="k">is</span><span class="p">:</span> <span class="k">true</span>
</code></pre></div></div>

<hr />

<h2 id="çµè«–">çµè«–</h2>

<p>é€éè§£è­¯å™¨æ¨¡å¼ï¼Œæˆ‘å€‘æˆåŠŸè§£æ±ºäº†å¸ƒæ—é‹ç®—ç³»çµ±çš„è¨­è¨ˆæŒ‘æˆ°ï¼Œä¸¦å¯¦ç¾ä»¥ä¸‹å„ªå‹¢ï¼š</p>

<ol>
  <li>
    <p><strong>çµæ§‹æ¸…æ™°</strong></p>

    <ul>
      <li>å°‡æ¯å€‹é‹ç®—ç¬¦å’Œæ“ä½œæ•¸å°è£æˆè¡¨é”å¼é¡åˆ¥ï¼Œä¾¿æ–¼çµ„åˆèˆ‡ç®¡ç†ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>æ˜“æ–¼æ“´å±•</strong></p>

    <ul>
      <li>æ–°å¢é‹ç®—ç¬¦åªéœ€å¯¦ç¾æ–°çš„è¡¨é”å¼é¡åˆ¥ï¼Œç¬¦åˆé–‹æ”¾é—œé–‰åŸå‰‡ (OCP)ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>éˆæ´»æ€§é«˜</strong></p>
    <ul>
      <li>æ”¯æŒå‹•æ…‹æ§‹å»ºèˆ‡è§£è­¯è¤‡é›œè¡¨é”å¼ï¼Œé©ç”¨æ–¼å¤šç¨®é‹ç®—å ´æ™¯ã€‚</li>
    </ul>
  </li>
</ol>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè§£è­¯å™¨æ¨¡å¼æ›´é©åˆè™•ç†çµæ§‹ç°¡å–®çš„èªæ³•ã€‚å¦‚æœèªæ³•éæ–¼è¤‡é›œï¼Œå¯èƒ½å°è‡´é¡åˆ¥æ•¸é‡æ¿€å¢ï¼Œé€™æ™‚å¯ä»¥è€ƒæ…®çµåˆå…¶ä»–æ¨¡å¼ï¼ˆå¦‚çµ„åˆæ¨¡å¼æˆ–è¨ªå•è€…æ¨¡å¼ï¼‰é€²è¡Œå„ªåŒ–ã€‚</p>]]></content><author><name>Nick Huang</name></author><category term="Design Pattern" /><category term="Interpreter Pattern" /><summary type="html"><![CDATA[è§£è­¯å™¨æ¨¡å¼ç”¨æ–¼æ§‹å»ºä¸€å€‹å¯è§£è®€ç‰¹å®šèªè¨€æˆ–èªæ³•çš„ç³»çµ±ï¼Œé©åˆæ–¼è™•ç†è¤‡é›œçš„è¦å‰‡åˆ¤æ–·æˆ–æŒ‡ä»¤èªæ³•ã€‚]]></summary></entry><entry><title type="html">Design Pattern (27) - Visitor Pattern (è¨ªå•è€…æ¨¡å¼)</title><link href="https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-27-visitor-pattern/" rel="alternate" type="text/html" title="Design Pattern (27) - Visitor Pattern (è¨ªå•è€…æ¨¡å¼)" /><published>2024-12-28T13:30:00+00:00</published><updated>2024-12-28T13:30:00+00:00</updated><id>https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-27-visitor-pattern</id><content type="html" xml:base="https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-27-visitor-pattern/"><![CDATA[<blockquote>
  <p>æ‚¨å¯æ–¼æ­¤ <a href="https://github.com/nickhuangcyh/design_pattern">design_pattern repo</a> ä¸‹è¼‰ Design Pattern ç³»åˆ—ç¨‹å¼ç¢¼ã€‚</p>
</blockquote>

<hr />

<h2 id="éœ€æ±‚">éœ€æ±‚</h2>

<p>åœ¨è¨­è¨ˆä¸€å€‹ <strong>IoT App æ•´åˆå¤šå“ç‰Œ IPCam çš„åŠŸèƒ½</strong> æ™‚ï¼Œæˆ‘å€‘éœ€è¦æ»¿è¶³ä»¥ä¸‹éœ€æ±‚ï¼š</p>

<ol>
  <li>æ”¯æ´å¤šç¨® IPCam å“ç‰Œï¼Œé€™äº›å“ç‰Œçš„ IPCam æä¾›ä¸åŒçš„ä¸²æµèˆ‡æˆªåœ–æ–¹å¼ï¼š
    <ul>
      <li><strong>HIKVISION</strong> æä¾› RTSP å”å®šï¼Œå¯ä»¥ç”¨é€šç”¨æ–¹å¼æ’­æ”¾ä¸²æµèˆ‡æˆªåœ–ã€‚</li>
      <li><strong>DAHUA</strong> æä¾›è‡ªå®¶ SDKï¼Œéœ€è¦ä¾è³´ SDK æä¾›çš„æ–¹æ³•é€²è¡Œæ“ä½œã€‚</li>
    </ul>
  </li>
  <li><strong>App çš„ç¨‹å¼ç¢¼çµæ§‹ä¸æ‡‰ä¾è³´ IPCam å“ç‰Œçš„å¯¦ç¾ç´°ç¯€</strong>ï¼Œæ‡‰ä¿æŒé–‹æ”¾æ“´å±•æ€§ï¼Œæ–¹ä¾¿å¾ŒçºŒæ–°å¢æ–°çš„ IPCam å“ç‰Œã€‚</li>
  <li><strong>é¿å…ä¿®æ”¹ IPCam çš„æ ¸å¿ƒçµæ§‹</strong>ï¼Œå› ç‚ºé€™äº›å“ç‰Œçš„å¯¦ç¾é€šå¸¸ç”±å» å•†æä¾›ï¼Œç„¡æ³•ç›´æ¥ä¿®æ”¹ã€‚</li>
</ol>

<hr />

<h2 id="ç‰©ä»¶å°å‘åˆ†æ-ooa">ç‰©ä»¶å°å‘åˆ†æ (OOA)</h2>

<p>ç†è§£éœ€æ±‚å¾Œï¼Œè®“æˆ‘å€‘ä¾†å¿«é€Ÿå¯¦ä½œç‰©ä»¶å°å‘åˆ†æå§ï¼</p>

<p><img src="/blog/assets/images/design_pattern_visitor_pattern_uml_1.png" alt="visitor_pattern_uml_1" /></p>

<h3 id="å¯Ÿè¦º-forces">å¯Ÿè¦º Forces</h3>

<p>å¦‚æœæœªå¥—ç”¨è¨­è¨ˆæ¨¡å¼ï¼Œæˆ‘å€‘å¯èƒ½æœƒé‡åˆ°ä»¥ä¸‹å•é¡Œï¼š</p>

<ol>
  <li><strong>é›£ä»¥æ“´å±•æ–°å“ç‰Œ</strong>
    <ul>
      <li>æ¯æ–°å¢ä¸€å€‹å“ç‰Œçš„ IPCamï¼Œå°±éœ€è¦ä¿®æ”¹ App çš„æ ¸å¿ƒé‚è¼¯ã€‚</li>
    </ul>
  </li>
  <li><strong>é•åé–‹æ”¾é—œé–‰åŸå‰‡ (OCP)</strong>
    <ul>
      <li>æ ¸å¿ƒé‚è¼¯èˆ‡å“ç‰Œå¯¦ç¾ç´°ç¯€è€¦åˆï¼Œæ–°å¢åŠŸèƒ½éœ€è¦ä¿®æ”¹æ ¸å¿ƒç¨‹å¼ç¢¼ã€‚</li>
    </ul>
  </li>
  <li><strong>ç„¡æ³•çµ±ä¸€è™•ç†ä¸åŒå“ç‰Œçš„æ“ä½œ</strong>
    <ul>
      <li>æ¯å€‹å“ç‰Œçš„ä¸²æµèˆ‡æˆªåœ–æ–¹å¼ä¸åŒï¼Œå°è‡´ç¨‹å¼ç¢¼æ··äº‚ï¼Œé›£ä»¥ç¶­è­·ã€‚</li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="å¥—ç”¨-visitor-pattern-solution-å¾—åˆ°æ–°çš„-context-resulting-context">å¥—ç”¨ Visitor Pattern (Solution) å¾—åˆ°æ–°çš„ Context (Resulting Context)</h2>

<p>åšå®Œ OOAï¼Œå¯Ÿè¦º Forcesï¼Œçœ‹æ¸…æ¥šæ•´å€‹ Context å¾Œï¼Œå°±å¯ä»¥ä¾†å¥—ç”¨ Visitor Pattern è§£æ±ºé€™å€‹å•é¡Œã€‚</p>

<p>å…ˆä¾†çœ‹ä¸€ä¸‹ Visitor Pattern çš„ UML</p>

<p><img src="/blog/assets/images/design_pattern_visitor_pattern_uml_2.png" alt="visitor_pattern_uml_2" /></p>

<h3 id="visitor-pattern-çš„çµ„ä»¶">Visitor Pattern çš„çµ„ä»¶</h3>

<p>è¨ªå•è€…æ¨¡å¼çš„æ ¸å¿ƒçµ„ä»¶åŒ…æ‹¬ï¼š</p>

<ol>
  <li>
    <p><strong>Visitor (è¨ªå•è€…ä»‹é¢)</strong></p>

    <ul>
      <li>å®šç¾©å°æ¯ç¨®é¡å‹ç‰©ä»¶çš„æ“ä½œæ–¹æ³•ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>ConcreteVisitor (å…·é«”è¨ªå•è€…)</strong></p>

    <ul>
      <li>å¯¦ç¾ç‰¹å®šæ“ä½œé‚è¼¯ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>Element (å…ƒç´ ä»‹é¢)</strong></p>

    <ul>
      <li>å®šç¾©æ¥å—è¨ªå•è€…çš„æ–¹æ³• (<code class="language-plaintext highlighter-rouge">accept</code>)ï¼Œä¸¦å°‡è¨ªå•è€…å‚³éçµ¦è‡ªå·±ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>ConcreteElement (å…·é«”å…ƒç´ )</strong></p>
    <ul>
      <li>å¯¦ç¾æ¥å—è¨ªå•è€…çš„æ–¹æ³•ï¼Œè®“è¨ªå•è€…èƒ½å¤ è¨ªå•ä¸¦æ“ä½œå…·é«”å…ƒç´ ã€‚</li>
    </ul>
  </li>
</ol>

<p>å°‡ Visitor Pattern å¥—ç”¨åˆ°æˆ‘å€‘çš„æ‡‰ç”¨å§</p>

<p><img src="/blog/assets/images/design_pattern_visitor_pattern_uml_3.png" alt="visitor_pattern_uml_3" /></p>

<hr />

<h2 id="ç‰©ä»¶å°å‘è¨­è¨ˆ-oop">ç‰©ä»¶å°å‘è¨­è¨ˆ (OOP)</h2>

<p>[Element: IPCam]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">IPCam</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">accept</span><span class="p">(</span><span class="n">visitor</span><span class="p">:</span> <span class="nc">IPCamVisitor</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[ConcreteElements: HikvisionIPCam, DahuaIPCam]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">HikvisionIPCam</span> <span class="p">:</span> <span class="nc">IPCam</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">accept</span><span class="p">(</span><span class="n">visitor</span><span class="p">:</span> <span class="nc">IPCamVisitor</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">visitor</span><span class="p">.</span><span class="nf">visitHikvision</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">getRTSPStream</span><span class="p">():</span> <span class="nc">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"rtsp://hikvision/stream"</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">captureSnapshot</span><span class="p">():</span> <span class="nc">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"Hikvision Snapshot"</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">DahuaIPCam</span> <span class="p">:</span> <span class="nc">IPCam</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">accept</span><span class="p">(</span><span class="n">visitor</span><span class="p">:</span> <span class="nc">IPCamVisitor</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">visitor</span><span class="p">.</span><span class="nf">visitDahua</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">startSDKStream</span><span class="p">():</span> <span class="nc">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"Dahua SDK Stream"</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">takeSDKSnapshot</span><span class="p">():</span> <span class="nc">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"Dahua Snapshot"</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[Visitor: IPCamVisitor]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">IPCamVisitor</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">visitHikvision</span><span class="p">(</span><span class="n">ipCam</span><span class="p">:</span> <span class="nc">HikvisionIPCam</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">visitDahua</span><span class="p">(</span><span class="n">ipCam</span><span class="p">:</span> <span class="nc">DahuaIPCam</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[ConcreteVisitors: IPCamStreamingVisitor, IPCamSnapshotVisitor]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">IPCamStreamingVisitor</span> <span class="p">:</span> <span class="nc">IPCamVisitor</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">visitHikvision</span><span class="p">(</span><span class="n">ipCam</span><span class="p">:</span> <span class="nc">HikvisionIPCam</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"Streaming: ${ipCam.getRTSPStream()}"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">visitDahua</span><span class="p">(</span><span class="n">ipCam</span><span class="p">:</span> <span class="nc">DahuaIPCam</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"Streaming: ${ipCam.startSDKStream()}"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">IPCamSnapshotVisitor</span> <span class="p">:</span> <span class="nc">IPCamVisitor</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">visitHikvision</span><span class="p">(</span><span class="n">ipCam</span><span class="p">:</span> <span class="nc">HikvisionIPCam</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"Snapshot: ${ipCam.captureSnapshot()}"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">visitDahua</span><span class="p">(</span><span class="n">ipCam</span><span class="p">:</span> <span class="nc">DahuaIPCam</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"Snapshot: ${ipCam.takeSDKSnapshot()}"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[Client]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">ipCams</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">IPCam</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="nc">HikvisionIPCam</span><span class="p">(),</span> <span class="nc">DahuaIPCam</span><span class="p">())</span>
    <span class="kd">val</span> <span class="py">streamingVisitor</span> <span class="p">=</span> <span class="nc">IPCamStreamingVisitor</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">snapshotVisitor</span> <span class="p">=</span> <span class="nc">IPCamSnapshotVisitor</span><span class="p">()</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">ipCam</span> <span class="k">in</span> <span class="n">ipCams</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ipCam</span><span class="p">.</span><span class="nf">accept</span><span class="p">(</span><span class="n">streamingVisitor</span><span class="p">)</span>
        <span class="n">ipCam</span><span class="p">.</span><span class="nf">accept</span><span class="p">(</span><span class="n">snapshotVisitor</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[Output]</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Streaming: rtsp://hikvision/stream
Snapshot: Hikvision Snapshot
Streaming: Dahua SDK Stream
Snapshot: Dahua Snapshot
</code></pre></div></div>

<hr />

<h2 id="çµè«–">çµè«–</h2>

<p>é€é Visitor Patternï¼Œæˆ‘å€‘æˆåŠŸå°‡ä¸åŒå“ç‰Œ IPCam çš„æ“ä½œé‚è¼¯èˆ‡ç‰©ä»¶çµæ§‹åˆ†é›¢ï¼Œä¸¦å¯¦ç¾ä»¥ä¸‹å„ªå‹¢ï¼š</p>

<ol>
  <li>
    <p><strong>æ˜“æ–¼æ“´å±•æ–°å“ç‰Œ</strong></p>

    <ul>
      <li>æ–°å¢å“ç‰Œåªéœ€å¯¦ä½œæ–°çš„ <code class="language-plaintext highlighter-rouge">ConcreteElement</code> é¡åˆ¥ï¼Œä¸¦åœ¨è¨ªå•è€…ä¸­æ–°å¢ç›¸æ‡‰çš„æ“ä½œæ–¹æ³•ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>æ“ä½œé‚è¼¯é›†ä¸­</strong></p>

    <ul>
      <li>ä¸åŒå“ç‰Œçš„æ“ä½œé‚è¼¯é›†ä¸­æ–¼è¨ªå•è€…ä¸­ï¼Œä¾¿æ–¼ç¶­è­·èˆ‡ç®¡ç†ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>ç¬¦åˆè¨­è¨ˆåŸå‰‡</strong></p>
    <ul>
      <li>å–®ä¸€è·è²¬åŸå‰‡ (SRP)ï¼šæ“ä½œé‚è¼¯èˆ‡ç‰©ä»¶çµæ§‹åˆ†é›¢ã€‚</li>
      <li>é–‹æ”¾é—œé–‰åŸå‰‡ (OCP)ï¼šå…è¨±æ–°å¢åŠŸèƒ½è€Œä¸ä¿®æ”¹æ—¢æœ‰ç¨‹å¼ç¢¼ã€‚</li>
    </ul>
  </li>
</ol>

<p>è¨ªå•è€…æ¨¡å¼éå¸¸é©åˆè™•ç†ä»¥ä¸‹å ´æ™¯ï¼š</p>

<ul>
  <li>å¤šç¨®é¡å‹ç‰©ä»¶éœ€è¦åŸ·è¡Œä¸åŒæ“ä½œã€‚</li>
  <li>ç‰©ä»¶çµæ§‹ç©©å®šï¼Œä½†æ“ä½œé‚è¼¯ç¶“å¸¸è®ŠåŒ–ã€‚</li>
</ul>

<p>è¨ªå•è€…æ¨¡å¼ç‚ºå¤šè®Šæ“ä½œæä¾›äº†ä¸€å€‹å„ªé›…çš„è§£æ±ºæ–¹æ¡ˆï¼Œç¢ºä¿ç³»çµ±å…·æœ‰é«˜æ“´å±•æ€§èˆ‡éˆæ´»æ€§ã€‚</p>]]></content><author><name>Nick Huang</name></author><category term="Design Pattern" /><category term="Visitor Pattern" /><summary type="html"><![CDATA[è¨ªå•è€…æ¨¡å¼æä¾›äº†ä¸€ç¨®æ–¹å¼ï¼Œè®“æˆ‘å€‘èƒ½åœ¨ä¸ä¿®æ”¹ç‰©ä»¶çµæ§‹çš„å‰æä¸‹ï¼Œç‚ºå…¶å¢åŠ æ–°çš„æ“ä½œé‚è¼¯ï¼Œå¯¦ç¾é«˜æ“´å±•æ€§ã€‚]]></summary></entry><entry><title type="html">Design Pattern (26) - Template Method Pattern (æ¨¡æ¿æ–¹æ³•æ¨¡å¼)</title><link href="https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-26-template-method-pattern/" rel="alternate" type="text/html" title="Design Pattern (26) - Template Method Pattern (æ¨¡æ¿æ–¹æ³•æ¨¡å¼)" /><published>2024-12-28T11:30:00+00:00</published><updated>2024-12-28T11:30:00+00:00</updated><id>https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-26-template-method-pattern</id><content type="html" xml:base="https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-26-template-method-pattern/"><![CDATA[<blockquote>
  <p>æ‚¨å¯æ–¼æ­¤ <a href="https://github.com/nickhuangcyh/design_pattern">design_pattern repo</a> ä¸‹è¼‰ Design Pattern ç³»åˆ—ç¨‹å¼ç¢¼ã€‚</p>
</blockquote>

<hr />

<h2 id="éœ€æ±‚">éœ€æ±‚</h2>

<p>åœ¨è¨­è¨ˆä¸€å€‹ <strong>è³‡æ–™æ ¼å¼è½‰æ›ç³»çµ±</strong> æ™‚ï¼Œæˆ‘å€‘éœ€è¦æ»¿è¶³ä»¥ä¸‹éœ€æ±‚ï¼š</p>

<ol>
  <li>æ”¯æ´å¤šç¨®æ ¼å¼è½‰æ›ï¼Œä¾‹å¦‚ï¼š
    <ul>
      <li><strong>JSON æ ¼å¼è½‰æ›</strong>ï¼šå°‡è³‡æ–™è½‰æ›ç‚º JSON æ ¼å¼ã€‚</li>
      <li><strong>XML æ ¼å¼è½‰æ›</strong>ï¼šå°‡è³‡æ–™è½‰æ›ç‚º XML æ ¼å¼ã€‚</li>
      <li><strong>CSV æ ¼å¼è½‰æ›</strong>ï¼šå°‡è³‡æ–™è½‰æ›ç‚º CSV æ ¼å¼ã€‚</li>
    </ul>
  </li>
  <li>ç³»çµ±éœ€å…·å‚™è‰¯å¥½çš„æ“´å±•æ€§ï¼š
    <ul>
      <li>èƒ½å¤ æ–¹ä¾¿åœ°æ–°å¢æ–°çš„æ ¼å¼è½‰æ›æ–¹å¼ã€‚</li>
    </ul>
  </li>
  <li><strong>ä¿æŒè½‰æ›æµç¨‹æ ¸å¿ƒä¸€è‡´æ€§</strong>ï¼Œä¾‹å¦‚ï¼š
    <ul>
      <li>æ‰€æœ‰æ ¼å¼è½‰æ›éƒ½éœ€è¦ï¼šè®€å–è³‡æ–™ã€æ ¼å¼åŒ–è³‡æ–™ã€è¼¸å‡ºè³‡æ–™ã€‚</li>
    </ul>
  </li>
  <li><strong>é¿å…é‡è¤‡ç¨‹å¼ç¢¼</strong>ã€‚</li>
</ol>

<hr />

<h2 id="ç‰©ä»¶å°å‘åˆ†æ-ooa">ç‰©ä»¶å°å‘åˆ†æ (OOA)</h2>

<p>ç†è§£éœ€æ±‚å¾Œï¼Œè®“æˆ‘å€‘ä¾†å¿«é€Ÿå¯¦ä½œç‰©ä»¶å°å‘åˆ†æå§!</p>

<p><img src="/blog/assets/images/design_pattern_template_method_pattern_uml_1.png" alt="template_method_pattern_uml_1" /></p>

<h3 id="å¯Ÿè¦º-forces">å¯Ÿè¦º Forces</h3>

<p>å¦‚æœæœªå¥—ç”¨è¨­è¨ˆæ¨¡å¼ï¼Œæˆ‘å€‘å¯èƒ½æœƒé‡åˆ°ä»¥ä¸‹å•é¡Œï¼š</p>

<ol>
  <li><strong>ç¨‹å¼ç¢¼é‡è¤‡</strong>
    <ul>
      <li>æ¯ç¨®æ ¼å¼çš„è½‰æ›é‚è¼¯ä¸­åŒ…å«ç›¸åŒæ­¥é©Ÿï¼Œä½†è¢«å¤šæ¬¡é‡è¤‡å¯¦ä½œã€‚</li>
    </ul>
  </li>
  <li><strong>é•åé–‹æ”¾é—œé–‰åŸå‰‡ (OCP)</strong>
    <ul>
      <li>æ–°å¢æ ¼å¼éœ€è¦ä¿®æ”¹æ ¸å¿ƒè½‰æ›é‚è¼¯ã€‚</li>
    </ul>
  </li>
  <li><strong>é›£ä»¥ç¶­è­·èˆ‡æ“´å±•</strong>
    <ul>
      <li>å„æ ¼å¼è½‰æ›é‚è¼¯åˆ†æ•£ï¼Œé›£ä»¥çµ±ä¸€ç®¡ç†èˆ‡ä¿®æ”¹ã€‚</li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="å¥—ç”¨-template-method-pattern-solution-å¾—åˆ°æ–°çš„-context-resulting-context">å¥—ç”¨ Template Method Pattern (Solution) å¾—åˆ°æ–°çš„ Context (Resulting Context)</h2>

<p>åšå®Œ OOAï¼Œå¯Ÿè¦º Forcesï¼Œçœ‹æ¸…æ¥šæ•´å€‹ Context å¾Œï¼Œå°±å¯ä»¥ä¾†å¥—ç”¨ Template Method Pattern è§£æ±ºé€™å€‹å•é¡Œã€‚</p>

<p>å…ˆä¾†çœ‹ä¸€ä¸‹ Template Method Pattern çš„ UML</p>

<p><img src="/blog/assets/images/design_pattern_template_method_pattern_uml_2.png" alt="template_method_pattern_uml_2" /></p>

<h3 id="template-method-pattern-çš„çµ„ä»¶">Template Method Pattern çš„çµ„ä»¶</h3>

<p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒçµ„ä»¶åŒ…æ‹¬ï¼š</p>

<ol>
  <li>
    <p><strong>AbstractClass (æŠ½è±¡é¡åˆ¥)</strong></p>

    <ul>
      <li>å®šç¾©æ¨¡æ¿æ–¹æ³• (Template Method)ï¼Œå°è£æ ¸å¿ƒæµç¨‹ã€‚</li>
      <li>æä¾›éƒ¨åˆ†æ­¥é©Ÿçš„é è¨­å¯¦ä½œï¼Œæˆ–å°‡å…¶æ¨™è¨˜ç‚ºæŠ½è±¡ï¼Œç”±å­é¡åˆ¥å¯¦ç¾ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>ConcreteClass (å…·é«”é¡åˆ¥)</strong></p>
    <ul>
      <li>ç¹¼æ‰¿æŠ½è±¡é¡åˆ¥ï¼Œå¯¦ç¾å…·é«”æ­¥é©Ÿã€‚</li>
    </ul>
  </li>
</ol>

<p>ä»¥ä¸‹æ˜¯ Template Method Pattern çš„ UML åœ–ï¼š</p>

<p><img src="/blog/assets/images/design_pattern_template_method_pattern_uml_3.png" alt="template_method_pattern_uml_3" /></p>

<hr />

<h2 id="ç‰©ä»¶å°å‘è¨­è¨ˆ-oop">ç‰©ä»¶å°å‘è¨­è¨ˆ (OOP)</h2>

<p>[AbstractClass: DataFormatter]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">abstract</span> <span class="kd">class</span> <span class="nc">DataFormatter</span> <span class="p">{</span>

    <span class="k">fun</span> <span class="nf">convert</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">Any</span><span class="p">&gt;):</span> <span class="nc">String</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">rawData</span> <span class="p">=</span> <span class="nf">readData</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">formattedData</span> <span class="p">=</span> <span class="nf">formatData</span><span class="p">(</span><span class="n">rawData</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">outputData</span><span class="p">(</span><span class="n">formattedData</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">readData</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">Any</span><span class="p">&gt;):</span> <span class="nc">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">.</span><span class="nf">toString</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1">// subclass implementation</span>
    <span class="k">protected</span> <span class="k">abstract</span> <span class="k">fun</span> <span class="nf">formatData</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">String</span>

    <span class="k">protected</span> <span class="k">abstract</span> <span class="k">fun</span> <span class="nf">outputData</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">String</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[ConcreteClasses: JsonFormatter, XmlFormatter, CsvFormatter]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">JsonFormatter</span> <span class="p">:</span> <span class="nc">DataFormatter</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">formatData</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"{\"data\": \"$data\"}"</span> <span class="c1">// æ¨¡æ“¬ JSON æ ¼å¼åŒ–</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">outputData</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"JSON Output: $data"</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">XmlFormatter</span> <span class="p">:</span> <span class="nc">DataFormatter</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">formatData</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"&lt;data&gt;$data&lt;/data&gt;"</span> <span class="c1">// æ¨¡æ“¬ XML æ ¼å¼åŒ–</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">outputData</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"XML Output: $data"</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">CsvFormatter</span> <span class="p">:</span> <span class="nc">DataFormatter</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">formatData</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="s">", "</span><span class="p">,</span> <span class="s">"\n"</span><span class="p">)</span> <span class="c1">// æ¨¡æ“¬ CSV æ ¼å¼åŒ–</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">outputData</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"CSV Output: $data"</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[Client]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">data</span> <span class="p">=</span> <span class="nf">mapOf</span><span class="p">(</span><span class="s">"name"</span> <span class="n">to</span> <span class="s">"John"</span><span class="p">,</span> <span class="s">"age"</span> <span class="n">to</span> <span class="mi">30</span><span class="p">,</span> <span class="s">"city"</span> <span class="n">to</span> <span class="s">"New York"</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">jsonFormatter</span> <span class="p">=</span> <span class="nc">JsonFormatter</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="n">jsonFormatter</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

    <span class="kd">val</span> <span class="py">xmlFormatter</span> <span class="p">=</span> <span class="nc">XmlFormatter</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="n">xmlFormatter</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

    <span class="kd">val</span> <span class="py">csvFormatter</span> <span class="p">=</span> <span class="nc">CsvFormatter</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="n">csvFormatter</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[Output]</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>JSON Output: {"data": "{name=John, age=30, city=New York}"}
XML Output: &lt;data&gt;{name=John, age=30, city=New York}&lt;/data&gt;
CSV Output: name=John\nage=30\ncity=New York
</code></pre></div></div>

<hr />

<h2 id="çµè«–">çµè«–</h2>

<p>é€é Template Method Patternï¼Œæˆ‘å€‘æˆåŠŸå°‡è³‡æ–™æ ¼å¼è½‰æ›çš„é€šç”¨é‚è¼¯èˆ‡è®ŠåŒ–é‚è¼¯åˆ†é›¢ï¼Œä¸¦å¯¦ç¾ä»¥ä¸‹å„ªå‹¢ï¼š</p>

<ol>
  <li>
    <p><strong>ç¨‹å¼ç¢¼å¾©ç”¨æ€§é«˜</strong></p>

    <ul>
      <li>é€šç”¨çš„è½‰æ›æµç¨‹é‚è¼¯åœ¨æŠ½è±¡é¡åˆ¥ä¸­å¯¦ç¾ï¼Œé¿å…é‡è¤‡ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>æ˜“æ–¼æ“´å±•</strong></p>

    <ul>
      <li>æ–°å¢æ ¼å¼åªéœ€ç¹¼æ‰¿æŠ½è±¡é¡åˆ¥ä¸¦å¯¦ç¾ç‰¹å®šæ­¥é©Ÿã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>ç¬¦åˆè¨­è¨ˆåŸå‰‡</strong></p>
    <ul>
      <li>å–®ä¸€è·è²¬åŸå‰‡ (SRP)ï¼šæ ¸å¿ƒæµç¨‹èˆ‡ç‰¹å®šé‚è¼¯åˆ†é›¢ã€‚</li>
      <li>é–‹æ”¾é—œé–‰åŸå‰‡ (OCP)ï¼šå…è¨±æ–°å¢åŠŸèƒ½è€Œä¸ä¿®æ”¹æ—¢æœ‰ç¨‹å¼ç¢¼ã€‚</li>
    </ul>
  </li>
</ol>

<p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼éå¸¸é©åˆè™•ç†ä»¥ä¸‹å ´æ™¯ï¼š</p>

<ul>
  <li>ä¸åŒçš„è³‡æ–™æ ¼å¼è½‰æ›æµç¨‹ã€‚</li>
  <li>æ–‡æª”ç”Ÿæˆæµç¨‹ (ä¾‹å¦‚ï¼šPDFã€Excel)ã€‚</li>
  <li>å¤šç¨®è³‡æ–™è™•ç†çš„éç¨‹ã€‚</li>
</ul>

<p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ç¢ºä¿ç³»çµ±æ ¸å¿ƒæµç¨‹çš„ä¸€è‡´æ€§ï¼Œç‚ºå¯¦ç¾éˆæ´»ä¸”é«˜æ•ˆçš„æ“´å±•æä¾›äº†ä¸€å€‹å„ªé›…çš„è§£æ±ºæ–¹æ¡ˆã€‚</p>]]></content><author><name>Nick Huang</name></author><category term="Design Pattern" /><category term="Template Method Pattern" /><summary type="html"><![CDATA[æ¨¡æ¿æ–¹æ³•æ¨¡å¼æä¾›äº†ä¸€å€‹æ¡†æ¶ï¼Œå…è¨±å­é¡åˆ¥é‡æ–°å®šç¾©ç‰¹å®šæ­¥é©Ÿçš„å¯¦ä½œï¼Œä¿æŒæ ¸å¿ƒæµç¨‹çš„ä¸€è‡´æ€§ï¼Œå¯¦ç¾é«˜å¾©ç”¨æ€§èˆ‡éˆæ´»æ€§ã€‚]]></summary></entry><entry><title type="html">Design Pattern (25) - Strategy Pattern (ç­–ç•¥æ¨¡å¼)</title><link href="https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-25-strategy-pattern/" rel="alternate" type="text/html" title="Design Pattern (25) - Strategy Pattern (ç­–ç•¥æ¨¡å¼)" /><published>2024-12-26T15:50:00+00:00</published><updated>2024-12-26T15:50:00+00:00</updated><id>https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-25-strategy-pattern</id><content type="html" xml:base="https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-25-strategy-pattern/"><![CDATA[<blockquote>
  <p>æ‚¨å¯æ–¼æ­¤ <a href="https://github.com/nickhuangcyh/design_pattern">design_pattern repo</a> ä¸‹è¼‰ Design Pattern ç³»åˆ—ç¨‹å¼ç¢¼ã€‚</p>
</blockquote>

<hr />

<h2 id="éœ€æ±‚">éœ€æ±‚</h2>

<p>åœ¨è¨­è¨ˆä¸€å€‹ <strong>é›»å•†é‹è²»è¨ˆç®—ç³»çµ±</strong> æ™‚ï¼Œæˆ‘å€‘éœ€è¦æ»¿è¶³ä»¥ä¸‹éœ€æ±‚ï¼š</p>

<ol>
  <li>æ”¯æ´å¤šç¨®é‹è²»è¨ˆç®—æ–¹å¼ï¼Œä¾‹å¦‚ï¼š
    <ul>
      <li><strong>ä¸€èˆ¬é…é€</strong>ï¼šå›ºå®šé‹è²»ã€‚</li>
      <li><strong>å¿«é€Ÿé…é€</strong>ï¼šä¾é‡é‡è¨ˆè²»ã€‚</li>
      <li><strong>åœ‹éš›é…é€</strong>ï¼šæ ¹æ“šåœ°å€èˆ‡é‡é‡è¨ˆè²»ã€‚</li>
    </ul>
  </li>
  <li>ç³»çµ±éœ€å…·å‚™è‰¯å¥½çš„æ“´å±•æ€§ï¼š
    <ul>
      <li>èƒ½å¤ æ–¹ä¾¿åœ°æ–°å¢æ–°çš„é‹è²»è¨ˆç®—æ–¹å¼ã€‚</li>
    </ul>
  </li>
  <li><strong>é¿å…ä½¿ç”¨å¤§é‡çš„ if-else æˆ– switch-case</strong>ã€‚</li>
  <li>ä½¿ç”¨è€…æ‡‰èƒ½è¼•é¬†åˆ‡æ›é‹è²»è¨ˆç®—æ–¹å¼ã€‚</li>
</ol>

<hr />

<h2 id="ç‰©ä»¶å°å‘åˆ†æ-ooa">ç‰©ä»¶å°å‘åˆ†æ (OOA)</h2>

<p>ç†è§£éœ€æ±‚å¾Œï¼Œè®“æˆ‘å€‘ä¾†å¿«é€Ÿå¯¦ä½œç‰©ä»¶å°å‘åˆ†æå§!</p>

<p><img src="/blog/assets/images/design_pattern_strategy_pattern_uml_1.png" alt="strategy_pattern_uml_1" /></p>

<h3 id="å¯Ÿè¦º-forces">å¯Ÿè¦º Forces</h3>

<p>å¦‚æœæœªå¥—ç”¨è¨­è¨ˆæ¨¡å¼ï¼Œæˆ‘å€‘å¯èƒ½æœƒé‡åˆ°ä»¥ä¸‹å•é¡Œï¼š</p>

<ol>
  <li>
    <p><strong>é›£ä»¥ç¶­è­·</strong></p>

    <ul>
      <li>é‹è²»è¨ˆç®—é‚è¼¯æ··é›œåœ¨ä¸»ç¨‹å¼å…§ï¼Œæ–°å¢æˆ–ä¿®æ”¹ä¸€ç¨®è¨ˆç®—æ–¹å¼å¯èƒ½æœƒå½±éŸ¿å…¶ä»–éƒ¨åˆ†ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>é•åé–‹æ”¾é—œé–‰åŸå‰‡ (OCP)</strong></p>

    <ul>
      <li>æ¯æ¬¡æ–°å¢é‹è²»è¨ˆç®—æ–¹å¼éƒ½éœ€ä¿®æ”¹æ ¸å¿ƒæ¥­å‹™é‚è¼¯ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>é•åå–®ä¸€è·è²¬åŸå‰‡ (SRP)</strong></p>
    <ul>
      <li>ä¸»ç¨‹å¼åŒæ™‚è² è²¬é‹è²»è¨ˆç®—èˆ‡æ ¸å¿ƒæ¥­å‹™é‚è¼¯ï¼Œè²¬ä»»éæ–¼ç¹é‡ã€‚</li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="å¥—ç”¨-strategy-pattern-solution-å¾—åˆ°æ–°çš„-context-resulting-context">å¥—ç”¨ Strategy Pattern (Solution) å¾—åˆ°æ–°çš„ Context (Resulting Context)</h2>

<p>åšå®Œ OOAï¼Œå¯Ÿè¦º Forcesï¼Œçœ‹æ¸…æ¥šæ•´å€‹ Context å¾Œï¼Œå°±å¯ä»¥ä¾†å¥—ç”¨ Strategy Pattern è§£æ±ºé€™å€‹å•é¡Œ</p>

<p>å…ˆä¾†çœ‹ä¸€ä¸‹ Strategy Pattern çš„ UML</p>

<p><img src="/blog/assets/images/design_pattern_strategy_pattern_uml_2.png" alt="strategy_pattern_uml_2" /></p>

<h3 id="strategy-pattern-çš„çµ„ä»¶">Strategy Pattern çš„çµ„ä»¶</h3>

<p>ç­–ç•¥æ¨¡å¼çš„æ ¸å¿ƒçµ„ä»¶åŒ…æ‹¬ï¼š</p>

<ol>
  <li>
    <p><strong>Strategy (ç­–ç•¥ä»‹é¢)</strong><br />
å®šç¾©æ‰€æœ‰ç­–ç•¥éœ€è¦å¯¦ç¾çš„è¡Œç‚ºã€‚</p>
  </li>
  <li>
    <p><strong>ConcreteStrategy (å…·é«”ç­–ç•¥)</strong><br />
æ¯å€‹å…·é«”ç­–ç•¥é¡åˆ¥å¯¦ç¾ç‰¹å®šçš„è¡Œç‚ºé‚è¼¯ã€‚</p>
  </li>
  <li>
    <p><strong>Context (ä¸Šä¸‹æ–‡)</strong><br />
ç¶­è­·ä¸€å€‹ç­–ç•¥ç‰©ä»¶ï¼Œä¸¦æ ¹æ“šç•¶å‰ç­–ç•¥åŸ·è¡Œå°æ‡‰è¡Œç‚ºã€‚</p>
  </li>
</ol>

<p>å°‡ Strategy Pattern å¥—ç”¨åˆ°æˆ‘å€‘çš„æ‡‰ç”¨å§</p>

<p><img src="/blog/assets/images/design_pattern_strategy_pattern_uml_3.png" alt="strategy_pattern_uml_3" /></p>

<hr />

<h2 id="ç‰©ä»¶å°å‘è¨­è¨ˆ-oop">ç‰©ä»¶å°å‘è¨­è¨ˆ (OOP)</h2>

<p>[Strategy: ShippingStrategy]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">ShippingStrategy</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">calculateShippingCost</span><span class="p">(</span><span class="n">weight</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span> <span class="n">region</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Double</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[ConcreteStrategies: RegularShipping, ExpressShipping, InternationalShipping]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">RegularShipping</span> <span class="p">:</span> <span class="nc">ShippingStrategy</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">calculateShippingCost</span><span class="p">(</span><span class="n">weight</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span> <span class="n">region</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Double</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mf">50.0</span> <span class="c1">// å›ºå®šé‹è²»</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ExpressShipping</span> <span class="p">:</span> <span class="nc">ShippingStrategy</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">calculateShippingCost</span><span class="p">(</span><span class="n">weight</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span> <span class="n">region</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Double</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">weight</span> <span class="p">*</span> <span class="mi">10</span> <span class="c1">// æ¯å…¬æ–¤ 10 å…ƒ</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">InternationalShipping</span> <span class="p">:</span> <span class="nc">ShippingStrategy</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">calculateShippingCost</span><span class="p">(</span><span class="n">weight</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span> <span class="n">region</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Double</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">regionMultiplier</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">region</span><span class="p">)</span> <span class="p">{</span>
            <span class="s">"Asia"</span> <span class="p">-&gt;</span> <span class="mi">15</span>
            <span class="s">"Europe"</span> <span class="p">-&gt;</span> <span class="mi">20</span>
            <span class="s">"America"</span> <span class="p">-&gt;</span> <span class="mi">25</span>
            <span class="k">else</span> <span class="p">-&gt;</span> <span class="mi">30</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">weight</span> <span class="p">*</span> <span class="n">regionMultiplier</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[Context: ShippingCalculator]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">ShippingCalculator</span><span class="p">(</span><span class="k">private</span> <span class="kd">var</span> <span class="py">strategy</span><span class="p">:</span> <span class="nc">ShippingStrategy</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">fun</span> <span class="nf">setStrategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">:</span> <span class="nc">ShippingStrategy</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">strategy</span> <span class="p">=</span> <span class="n">strategy</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">calculateCost</span><span class="p">(</span><span class="n">weight</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span> <span class="n">region</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Double</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">strategy</span><span class="p">.</span><span class="nf">calculateShippingCost</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>[Client]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">calculator</span> <span class="p">=</span> <span class="nc">ShippingCalculator</span><span class="p">(</span><span class="nc">RegularShipping</span><span class="p">())</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"ä¸€èˆ¬é…é€é‹è²»: ${calculator.calculateCost(5.0, "</span><span class="nc">Asia</span><span class="s">")} å…ƒ"</span><span class="p">)</span> <span class="c1">// å›ºå®š 50 å…ƒ</span>

    <span class="n">calculator</span><span class="p">.</span><span class="nf">setStrategy</span><span class="p">(</span><span class="nc">ExpressShipping</span><span class="p">())</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"å¿«é€Ÿé…é€é‹è²»: ${calculator.calculateCost(5.0, "</span><span class="nc">Asia</span><span class="s">")} å…ƒ"</span><span class="p">)</span> <span class="c1">// 5.0 * 10 = 50 å…ƒ</span>

    <span class="n">calculator</span><span class="p">.</span><span class="nf">setStrategy</span><span class="p">(</span><span class="nc">InternationalShipping</span><span class="p">())</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"åœ‹éš›é…é€é‹è²» (Asia): ${calculator.calculateCost(5.0, "</span><span class="nc">Asia</span><span class="s">")} å…ƒ"</span><span class="p">)</span> <span class="c1">// 5.0 * 15 = 75 å…ƒ</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[Output]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">ä¸€èˆ¬é…é€é‹è²»</span><span class="p">:</span> <span class="mf">50.0</span> <span class="err">å…ƒ</span>
<span class="err">å¿«é€Ÿé…é€é‹è²»</span><span class="p">:</span> <span class="mf">50.0</span> <span class="err">å…ƒ</span>
<span class="err">åœ‹éš›é…é€é‹è²»</span> <span class="p">(</span><span class="nc">Asia</span><span class="p">):</span> <span class="mf">75.0</span> <span class="err">å…ƒ</span>
</code></pre></div></div>

<h2 id="çµè«–">çµè«–</h2>

<p>é€é Strategy Patternï¼Œæˆ‘å€‘æˆåŠŸå°‡é‹è²»è¨ˆç®—é‚è¼¯èˆ‡æ ¸å¿ƒåŠŸèƒ½åˆ†é›¢ï¼Œä¸¦å¯¦ç¾ä»¥ä¸‹å„ªå‹¢ï¼š</p>

<ol>
  <li>æ˜“æ–¼æ“´å±•</li>
</ol>

<ul>
  <li>æ–°å¢é‹è²»è¨ˆç®—æ–¹å¼åªéœ€å¯¦ä½œæ–°çš„ç­–ç•¥é¡åˆ¥ï¼Œç„¡éœ€ä¿®æ”¹ç¾æœ‰ç¨‹å¼ç¢¼ã€‚</li>
</ul>

<ol>
  <li>ä½è€¦åˆæ€§</li>
</ol>

<ul>
  <li>é‹è²»è¨ˆç®—é‚è¼¯èˆ‡æ ¸å¿ƒæ¥­å‹™é‚è¼¯åˆ†é›¢ï¼Œå„è‡ªè² è²¬è‡ªå·±çš„åŠŸèƒ½ã€‚</li>
</ul>

<ol>
  <li>ç¬¦åˆè¨­è¨ˆåŸå‰‡</li>
</ol>

<ul>
  <li>å–®ä¸€è·è²¬åŸå‰‡ (SRP)ï¼šæ¯å€‹ç­–ç•¥é¡åˆ¥å°ˆæ³¨æ–¼ç‰¹å®šé‹è²»è¨ˆç®—é‚è¼¯ã€‚</li>
  <li>é–‹æ”¾é—œé–‰åŸå‰‡ (OCP)ï¼šç­–ç•¥æ¨¡å¼å…è¨±åœ¨ä¸ä¿®æ”¹ç¾æœ‰ç¨‹å¼ç¢¼çš„æƒ…æ³ä¸‹ï¼Œæ–°å¢æ–°åŠŸèƒ½ã€‚</li>
</ul>

<p>ç­–ç•¥æ¨¡å¼éå¸¸é©åˆè™•ç†éœ€è¦æ ¹æ“šæ¢ä»¶åŸ·è¡Œä¸åŒè¡Œç‚ºçš„å ´æ™¯ï¼Œä¾‹å¦‚ï¼š</p>

<ul>
  <li>ä¸åŒçš„æŠ˜æ‰£ç­–ç•¥ (æ»¿é¡æŠ˜æ‰£ã€å­£ç¯€æ€§å„ªæƒ )ã€‚</li>
  <li>ä¸åŒçš„æ’åºç®—æ³• (å¿«é€Ÿæ’åºã€åˆä½µæ’åº)ã€‚</li>
  <li>å„é¡ç¹³ç¨…è¨ˆç®—æ–¹å¼ã€‚</li>
</ul>

<p>ç­–ç•¥æ¨¡å¼è®“ç³»çµ±æ›´å…·å½ˆæ€§ï¼Œç‚ºè¤‡é›œå•é¡Œæä¾›äº†ä¸€å€‹å„ªé›…çš„è§£æ±ºæ–¹æ¡ˆã€‚</p>]]></content><author><name>Nick Huang</name></author><category term="Design Pattern" /><category term="Strategy Pattern" /><summary type="html"><![CDATA[ç­–ç•¥æ¨¡å¼æä¾›äº†ä¸€ç¨®éˆæ´»çš„è§£æ±ºæ–¹æ¡ˆï¼Œè®“ç³»çµ±èƒ½æ ¹æ“šéœ€æ±‚å‹•æ…‹åˆ‡æ›ä¸åŒçš„è¡Œç‚ºé‚è¼¯ï¼Œå¯¦ç¾é«˜å¯æ“´å±•æ€§èˆ‡ä½è€¦åˆæ€§ã€‚]]></summary></entry><entry><title type="html">Design Pattern (24) - State Pattern (ç‹€æ…‹æ¨¡å¼)</title><link href="https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-24-state-pattern/" rel="alternate" type="text/html" title="Design Pattern (24) - State Pattern (ç‹€æ…‹æ¨¡å¼)" /><published>2024-12-22T07:00:00+00:00</published><updated>2024-12-22T07:00:00+00:00</updated><id>https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-24-state-pattern</id><content type="html" xml:base="https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-24-state-pattern/"><![CDATA[<blockquote>
  <p>æ‚¨å¯æ–¼æ­¤ <a href="https://github.com/nickhuangcyh/design_pattern">design_pattern repo</a> ä¸‹è¼‰ Design Pattern ç³»åˆ—ç¨‹å¼ç¢¼ã€‚</p>
</blockquote>

<hr />

<h2 id="éœ€æ±‚">éœ€æ±‚</h2>

<p>æˆ‘å€‘çš„ä»»å‹™æ˜¯è¨­è¨ˆä¸€å€‹ <strong>é£²æ°´æ©Ÿ</strong>ï¼Œéœ€æ±‚å¦‚ä¸‹ï¼š</p>

<ul>
  <li>é£²æ°´æ©Ÿæœ‰ä¸‰ç¨®ç‹€æ…‹ï¼š
    <ul>
      <li><strong>åŠ ç†±ä¸­</strong>ï¼šæå‡æ°´æº«è‡³ç†±æ°´ã€‚</li>
      <li><strong>å†·å»ä¸­</strong>ï¼šé™ä½æ°´æº«è‡³å†·æ°´ã€‚</li>
      <li><strong>å¾…æ©Ÿä¸­</strong>ï¼šç¶­æŒç¾æœ‰æ°´æº«ã€‚</li>
    </ul>
  </li>
  <li>ä½¿ç”¨è€…å¯é€éæŒ‰éˆ•åˆ‡æ›é£²æ°´æ©Ÿçš„ç‹€æ…‹ã€‚</li>
  <li>é£²æ°´æ©Ÿéœ€è¦æ ¹æ“šç•¶å‰ç‹€æ…‹åŸ·è¡Œæ­£ç¢ºçš„è¡Œç‚ºï¼Œä¾‹å¦‚åŠ ç†±ç‹€æ…‹æ™‚åŠ ç†±æ°´ï¼Œä½†ä¸å¯å†·å»ã€‚</li>
</ul>

<hr />

<h2 id="ç‰©ä»¶å°å‘åˆ†æ-ooa">ç‰©ä»¶å°å‘åˆ†æ (OOA)</h2>

<p>ç†è§£éœ€æ±‚å¾Œï¼Œè®“æˆ‘å€‘ä¾†å¿«é€Ÿå¯¦ä½œç‰©ä»¶å°å‘åˆ†æå§!</p>

<p><img src="/blog/assets/images/design_pattern_state_pattern_uml_1.png" alt="state_pattern_uml_1" /></p>

<h3 id="å¯Ÿè¦º-forces">å¯Ÿè¦º Forces</h3>

<p>åœ¨æœªä½¿ç”¨è¨­è¨ˆæ¨¡å¼çš„æƒ…æ³ä¸‹ï¼Œæˆ‘å€‘å¯èƒ½é¢è‡¨ä»¥ä¸‹æŒ‘æˆ°ï¼š</p>

<ol>
  <li>
    <p><strong>é«˜è€¦åˆæ€§ (High Coupling)</strong></p>

    <ul>
      <li>ç‹€æ…‹é‚è¼¯èˆ‡é£²æ°´æ©Ÿæ ¸å¿ƒåŠŸèƒ½æ··åˆåœ¨ä¸€èµ·ï¼Œå°è‡´ç¨‹å¼ç¢¼é›£ä»¥ç¶­è­·ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>é•åå–®ä¸€è·è²¬åŸå‰‡ (SRP)</strong></p>

    <ul>
      <li>é£²æ°´æ©Ÿé¡åˆ¥éœ€è¦åŒæ™‚è™•ç†ç‹€æ…‹é‚è¼¯èˆ‡ä¸»è¦åŠŸèƒ½ï¼Œè²¬ä»»éæ–¼ç¹é‡ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>é›£ä»¥æ“´å±• (Hard to Extend)</strong></p>
    <ul>
      <li>æ–°å¢æˆ–ä¿®æ”¹ç‹€æ…‹è¡Œç‚ºéœ€æ›´æ”¹é£²æ°´æ©Ÿæ ¸å¿ƒé‚è¼¯ï¼Œé•åé–‹æ”¾é—œé–‰åŸå‰‡ (OCP)ã€‚</li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="å¥—ç”¨-state-pattern-solution-å¾—åˆ°æ–°çš„-context-resulting-context">å¥—ç”¨ State Pattern (Solution) å¾—åˆ°æ–°çš„ Context (Resulting Context)</h2>

<p>åšå®Œ OOAï¼Œå¯Ÿè¦º Forcesï¼Œçœ‹æ¸…æ¥šæ•´å€‹ Context å¾Œï¼Œå°±å¯ä»¥ä¾†å¥—ç”¨ State Pattern è§£æ±ºé€™å€‹å•é¡Œ</p>

<p>å¯Ÿè¦º Forces å¾Œï¼Œæˆ‘å€‘å¯ä»¥å¥—ç”¨ <strong>State Pattern</strong>ï¼Œå°‡ç‹€æ…‹é‚è¼¯å°è£æˆç¨ç«‹çš„é¡åˆ¥ï¼Œé”åˆ°ä»¥ä¸‹æ•ˆæœï¼š</p>

<p><img src="/blog/assets/images/design_pattern_state_pattern_uml_2.png" alt="state_pattern_uml_2" /></p>

<p>ç‹€æ…‹æ¨¡å¼æœ‰ä¸‰å€‹è§’è‰²:</p>

<ol>
  <li>
    <p><strong>State (ç‹€æ…‹ä»‹é¢)</strong><br />
å®šç¾©æ‰€æœ‰å…·é«”ç‹€æ…‹éœ€è¦å¯¦ç¾çš„è¡Œç‚ºã€‚</p>
  </li>
  <li>
    <p><strong>ConcreteState (å…·é«”ç‹€æ…‹)</strong><br />
æ¯å€‹å…·é«”ç‹€æ…‹é¡åˆ¥å¯¦ç¾ State ä»‹é¢ï¼Œä¸¦è² è²¬è©²ç‹€æ…‹ä¸‹çš„å…·é«”è¡Œç‚ºé‚è¼¯ã€‚</p>
  </li>
  <li>
    <p><strong>Context (ä¸Šä¸‹æ–‡)</strong><br />
è² è²¬ç¶­è­·ç•¶å‰ç‹€æ…‹ï¼Œä¸¦æä¾›ä»‹é¢è®“å¤–éƒ¨æ“ä½œã€‚åœ¨åŸ·è¡Œæ“ä½œæ™‚ï¼Œå°‡è«‹æ±‚å§”æ´¾çµ¦ç•¶å‰ç‹€æ…‹ç‰©ä»¶ã€‚</p>
  </li>
</ol>

<ul>
  <li>é£²æ°´æ©Ÿé¡åˆ¥è² è²¬ç‹€æ…‹ç®¡ç†ï¼Œè€Œéå…·é«”è¡Œç‚ºå¯¦ç¾ï¼Œé™ä½è€¦åˆåº¦ã€‚</li>
  <li>æ¯å€‹ç‹€æ…‹å°ˆæ³¨æ–¼è‡ªèº«è¡Œç‚ºï¼Œç¬¦åˆå–®ä¸€è·è²¬åŸå‰‡ã€‚</li>
  <li>æ–°å¢æˆ–ä¿®æ”¹ç‹€æ…‹ç„¡éœ€å½±éŸ¿é£²æ°´æ©Ÿæ ¸å¿ƒé‚è¼¯ï¼Œç¬¦åˆé–‹æ”¾é—œé–‰åŸå‰‡ã€‚</li>
</ul>

<p>å°‡ State Pattern å¥—ç”¨åˆ°æˆ‘å€‘çš„æ‡‰ç”¨å§</p>

<p><img src="/blog/assets/images/design_pattern_state_pattern_uml_3.png" alt="state_pattern_uml_3" /></p>

<hr />

<h2 id="ç‰©ä»¶å°å‘è¨­è¨ˆ-oop">ç‰©ä»¶å°å‘è¨­è¨ˆ (OOP)</h2>

<p>[State: WaterDispenserState]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">WaterDispenserState</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">handleRequest</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[ConcreteStates: HeatingState, CoolingState, StandbyState]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">HeatingState</span> <span class="p">:</span> <span class="nc">WaterDispenserState</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">handleRequest</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"åŠ ç†±ä¸­ï¼šæ°´æº«æ­£åœ¨æå‡ï¼Œè«‹ç¨å€™..."</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">CoolingState</span> <span class="p">:</span> <span class="nc">WaterDispenserState</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">handleRequest</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"å†·å»ä¸­ï¼šæ°´æº«æ­£åœ¨é™ä½ï¼Œè«‹ç¨å€™..."</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">StandbyState</span> <span class="p">:</span> <span class="nc">WaterDispenserState</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">handleRequest</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"å¾…æ©Ÿä¸­ï¼šé£²æ°´æ©Ÿç¶­æŒç¾æœ‰æ°´æº«ï¼Œéš¨æ™‚å¯ç”¨ã€‚"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[Context: WaterDispenser]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">WaterDispenser</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">currentState</span><span class="p">:</span> <span class="nc">WaterDispenserState</span> <span class="p">=</span> <span class="nc">StandbyState</span><span class="p">()</span>

    <span class="k">fun</span> <span class="nf">setState</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="nc">WaterDispenserState</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">currentState</span> <span class="p">=</span> <span class="n">state</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"ç‹€æ…‹åˆ‡æ›ï¼š${state::class.simpleName}"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">pressButton</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">currentState</span><span class="p">.</span><span class="nf">handleRequest</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[Client]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">dispenser</span> <span class="p">=</span> <span class="nc">WaterDispenser</span><span class="p">()</span>

    <span class="c1">// åˆå§‹ç‹€æ…‹ç‚ºå¾…æ©Ÿä¸­</span>
    <span class="n">dispenser</span><span class="p">.</span><span class="nf">pressButton</span><span class="p">()</span>

    <span class="c1">// åˆ‡æ›åˆ°åŠ ç†±ç‹€æ…‹</span>
    <span class="n">dispenser</span><span class="p">.</span><span class="nf">setState</span><span class="p">(</span><span class="nc">HeatingState</span><span class="p">())</span>
    <span class="n">dispenser</span><span class="p">.</span><span class="nf">pressButton</span><span class="p">()</span>

    <span class="c1">// åˆ‡æ›åˆ°å†·å»ç‹€æ…‹</span>
    <span class="n">dispenser</span><span class="p">.</span><span class="nf">setState</span><span class="p">(</span><span class="nc">CoolingState</span><span class="p">())</span>
    <span class="n">dispenser</span><span class="p">.</span><span class="nf">pressButton</span><span class="p">()</span>

    <span class="c1">// å›åˆ°å¾…æ©Ÿç‹€æ…‹</span>
    <span class="n">dispenser</span><span class="p">.</span><span class="nf">setState</span><span class="p">(</span><span class="nc">StandbyState</span><span class="p">())</span>
    <span class="n">dispenser</span><span class="p">.</span><span class="nf">pressButton</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[Output]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">å¾…æ©Ÿä¸­ï¼šé£²æ°´æ©Ÿç¶­æŒç¾æœ‰æ°´æº«ï¼Œéš¨æ™‚å¯ç”¨ã€‚</span>
<span class="err">ç‹€æ…‹åˆ‡æ›ï¼š</span><span class="nc">HeatingState</span>
<span class="err">åŠ ç†±ä¸­ï¼šæ°´æº«æ­£åœ¨æå‡ï¼Œè«‹ç¨å€™</span><span class="o">..</span><span class="p">.</span>
<span class="err">ç‹€æ…‹åˆ‡æ›ï¼š</span><span class="nc">CoolingState</span>
<span class="err">å†·å»ä¸­ï¼šæ°´æº«æ­£åœ¨é™ä½ï¼Œè«‹ç¨å€™</span><span class="o">..</span><span class="p">.</span>
<span class="err">ç‹€æ…‹åˆ‡æ›ï¼š</span><span class="nc">StandbyState</span>
<span class="err">å¾…æ©Ÿä¸­ï¼šé£²æ°´æ©Ÿç¶­æŒç¾æœ‰æ°´æº«ï¼Œéš¨æ™‚å¯ç”¨ã€‚</span>
</code></pre></div></div>

<h2 id="çµè«–">çµè«–</h2>

<p>é€é State Patternï¼Œæˆ‘å€‘æˆåŠŸå°‡é£²æ°´æ©Ÿçš„ç‹€æ…‹é‚è¼¯èˆ‡æ ¸å¿ƒåŠŸèƒ½åˆ†é›¢ï¼Œå¯¦ç¾ä»¥ä¸‹å„ªå‹¢ï¼š</p>

<ol>
  <li>é™ä½è€¦åˆåº¦</li>
</ol>

<ul>
  <li>é£²æ°´æ©Ÿé¡åˆ¥å°ˆæ³¨æ–¼ç‹€æ…‹åˆ‡æ›ï¼Œå…·é«”è¡Œç‚ºç”±ç‹€æ…‹é¡åˆ¥è² è²¬ã€‚</li>
</ul>

<ol>
  <li>ç¬¦åˆè¨­è¨ˆåŸå‰‡</li>
</ol>

<ul>
  <li>å–®ä¸€è·è²¬åŸå‰‡ (SRP)ï¼šæ¯å€‹ç‹€æ…‹é¡åˆ¥å°ˆæ³¨æ–¼è‡ªèº«è¡Œç‚ºã€‚</li>
  <li>é–‹æ”¾é—œé–‰åŸå‰‡ (OCP)ï¼šæ–°å¢ç‹€æ…‹ç„¡éœ€ä¿®æ”¹ç¾æœ‰ç¨‹å¼ç¢¼ã€‚</li>
</ul>

<ol>
  <li>æ˜“æ–¼æ“´å±•</li>
</ol>

<ul>
  <li>æ–°å¢æˆ–ä¿®æ”¹ç‹€æ…‹è¡Œç‚ºæ™‚ï¼Œä¸å½±éŸ¿å…¶ä»–éƒ¨åˆ†ã€‚</li>
</ul>

<p>æ­¤æ¨¡å¼ç‰¹åˆ¥é©åˆè™•ç†è¤‡é›œçš„ç‹€æ…‹è½‰æ›å ´æ™¯ï¼Œä¾‹å¦‚ï¼š</p>

<ul>
  <li>ATM æ©Ÿçš„æ’å¡ã€æ“ä½œã€å–å¡ç‹€æ…‹ã€‚</li>
  <li>æ–‡æª”ç·¨è¼¯å™¨çš„ç·¨è¼¯ã€æª¢è¦–ã€åˆ—å°æ¨¡å¼ã€‚</li>
</ul>

<p>ç‹€æ…‹æ¨¡å¼è®“ç¨‹å¼çµæ§‹æ›´å…·å½ˆæ€§ï¼Œæ˜¯é–‹ç™¼ç‹€æ…‹æ©Ÿåˆ¶æ‡‰ç”¨çš„æœ€ä½³é¸æ“‡ï¼</p>]]></content><author><name>Nick Huang</name></author><category term="Design Pattern" /><category term="State Pattern" /><summary type="html"><![CDATA[é€éç‹€æ…‹æ¨¡å¼ï¼Œè¨­è¨ˆä¸€å€‹é£²æ°´æ©Ÿçš„é‹ä½œæ©Ÿåˆ¶ï¼Œæ ¹æ“šä¸åŒç‹€æ…‹åŸ·è¡ŒåŠ ç†±ã€å†·å»æˆ–å¾…æ©Ÿçš„è¡Œç‚ºã€‚]]></summary></entry><entry><title type="html">Design Pattern (20) - Iterator Pattern (è¿­ä»£å™¨æ¨¡å¼)</title><link href="https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-20-iterator-pattern/" rel="alternate" type="text/html" title="Design Pattern (20) - Iterator Pattern (è¿­ä»£å™¨æ¨¡å¼)" /><published>2024-12-22T06:00:00+00:00</published><updated>2024-12-22T06:00:00+00:00</updated><id>https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-20-iterator-pattern</id><content type="html" xml:base="https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-20-iterator-pattern/"><![CDATA[<blockquote>
  <p>æ‚¨å¯æ–¼æ­¤ <a href="https://github.com/nickhuangcyh/design_pattern">design_pattern repo</a> ä¸‹è¼‰ Design Pattern ç³»åˆ—ç¨‹å¼ç¢¼ã€‚</p>
</blockquote>

<h2 id="éœ€æ±‚">éœ€æ±‚</h2>

<p>æˆ‘å€‘çš„ä»»å‹™æ˜¯è¨­è¨ˆä¸€å€‹æª”æ¡ˆç³»çµ±æœå°‹å·¥å…·ï¼Œéœ€æ±‚å¦‚ä¸‹ï¼š</p>

<ul>
  <li>ä½¿ç”¨è€…å¯ä»¥é¸æ“‡ä¸åŒçš„æª”æ¡ˆæœå°‹æ–¹å¼ï¼Œä¾‹å¦‚ <strong>å»£åº¦å„ªå…ˆæœå°‹ (BFS)</strong> æˆ– <strong>æ·±åº¦å„ªå…ˆæœå°‹ (DFS)</strong>ã€‚</li>
  <li>å®¢æˆ¶ç«¯ä¸éœ€è¦é—œå¿ƒæœå°‹é‚è¼¯çš„å¯¦ç¾ç´°ç¯€ï¼Œåªéœ€ä½¿ç”¨çµ±ä¸€çš„è¿­ä»£å™¨ä»‹é¢ä¾†éæ­·æœå°‹çµæœã€‚</li>
  <li>ç³»çµ±éœ€è¦å…·å‚™æ“´å±•æ€§ï¼Œæ–¹ä¾¿æ–°å¢å…¶ä»–æœå°‹æ³•ï¼Œä¾‹å¦‚åŸºæ–¼æª”æ¡ˆå¤§å°æ’åºçš„æœå°‹ã€‚</li>
</ul>

<h2 id="ç‰©ä»¶å°å‘åˆ†æ-ooa">ç‰©ä»¶å°å‘åˆ†æ (OOA)</h2>

<p>ç†è§£éœ€æ±‚å¾Œï¼Œè®“æˆ‘å€‘ä¾†å¿«é€Ÿå¯¦ä½œç‰©ä»¶å°å‘åˆ†æå§ï¼</p>

<p><img src="/blog/assets/images/design_pattern_iterator_pattern_uml_1.png" alt="iterator_pattern_uml_1" /></p>

<h2 id="å¯Ÿè¦º-forces">å¯Ÿè¦º Forces</h2>

<p>åœ¨æœªä½¿ç”¨è¨­è¨ˆæ¨¡å¼çš„æƒ…æ³ä¸‹ï¼Œæˆ‘å€‘å¯èƒ½é¢è‡¨ä»¥ä¸‹æŒ‘æˆ°ï¼š</p>

<ol>
  <li>
    <p><strong>é«˜è€¦åˆæ€§ (High Coupling)</strong>ï¼š</p>

    <ul>
      <li>å®¢æˆ¶ç«¯éœ€è¦ç›´æ¥æ“ä½œæ¯ç¨®æœå°‹æ–¹å¼çš„å¯¦ç¾ç´°ç¯€ï¼Œå°è‡´ä»£ç¢¼è‡ƒè…«ä¸”é›£ä»¥ç¶­è­·ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>ç¼ºä¹ä¸€è‡´æ€§ (Lack of Consistency)</strong>ï¼š</p>

    <ul>
      <li>ä¸åŒæœå°‹æ–¹å¼çš„çµæœè¨ªå•æ–¹å¼å¯èƒ½ä¸ä¸€è‡´ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>é•åé–‹æ”¾é—œé–‰åŸå‰‡ (Violates OCP)</strong>ï¼š</p>
    <ul>
      <li>è‹¥æ–°å¢æœå°‹æ³•æˆ–æ›´æ”¹ç¾æœ‰æœå°‹é‚è¼¯ï¼Œéœ€è¦ä¿®æ”¹å®¢æˆ¶ç«¯ç¨‹å¼ç¢¼ã€‚</li>
    </ul>
  </li>
</ol>

<h2 id="å¥—ç”¨-iterator-pattern-solution-å¾—åˆ°æ–°çš„-context-resulting-context">å¥—ç”¨ Iterator Pattern (Solution) å¾—åˆ°æ–°çš„ Context (Resulting Context)</h2>

<p>åšå®Œ OOAï¼Œå¯Ÿè¦º Forcesï¼Œçœ‹æ¸…æ¥šæ•´å€‹ Context å¾Œï¼Œå°±å¯ä»¥ä¾†å¥—ç”¨ Iterator Pattern è§£æ±ºé€™å€‹å•é¡Œã€‚</p>

<p>è¿­ä»£å™¨æ¨¡å¼å…è¨±æˆ‘å€‘å°æœå°‹çµæœé€²è¡Œé †åºè¨ªå•ï¼Œè€Œä¸éœ€è¦æš´éœ²æœå°‹é‚è¼¯çš„ç´°ç¯€ã€‚</p>

<p>å…ˆä¾†çœ‹ä¸€ä¸‹ Iterator Pattern çš„ UMLï¼š</p>

<p><img src="/blog/assets/images/design_pattern_iterator_pattern_uml_2.png" alt="iterator_pattern_uml_2" /></p>

<p>ä»¥ä¸‹æ˜¯ Iterator Pattern çš„ä¸»è¦è§’è‰²ï¼š</p>

<ul>
  <li><strong>Iterator (è¿­ä»£å™¨ä»‹é¢)</strong>ï¼šå®šç¾©è¨ªå•æœå°‹çµæœçš„æ–¹æ³•ï¼Œä¾‹å¦‚ <code class="language-plaintext highlighter-rouge">hasNext()</code> å’Œ <code class="language-plaintext highlighter-rouge">next()</code>ã€‚</li>
  <li><strong>ConcreteIterator (å…·é«”è¿­ä»£å™¨)</strong>ï¼šå¯¦ç¾ä¸åŒçš„æœå°‹é‚è¼¯ï¼Œå¦‚ BFS æˆ– DFSã€‚</li>
  <li><strong>Aggregate (èšåˆä»‹é¢)</strong>ï¼šå®šç¾©æ–¹æ³•ä¾†å‰µå»ºè¿­ä»£å™¨ã€‚</li>
  <li><strong>ConcreteAggregate (å…·é«”èšåˆé¡åˆ¥)</strong>ï¼šå¯¦ç¾èšåˆä»‹é¢ï¼Œæä¾›æª”æ¡ˆç³»çµ±è³‡æ–™çš„å…·é«”å¯¦ç¾ã€‚</li>
</ul>

<p>å°‡ Iterator Pattern å¥—ç”¨åˆ°æˆ‘å€‘çš„æ‡‰ç”¨å§</p>

<p><img src="/blog/assets/images/design_pattern_iterator_pattern_uml_3.png" alt="iterator_pattern_uml_3" /></p>

<h2 id="ç‰©ä»¶å°å‘ç¨‹å¼è¨­è¨ˆ-oop">ç‰©ä»¶å°å‘ç¨‹å¼è¨­è¨ˆ (OOP)</h2>

<p>[Iterator]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">Iterator</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">hasNext</span><span class="p">():</span> <span class="nc">Boolean</span>
    <span class="k">fun</span> <span class="nf">next</span><span class="p">():</span> <span class="nc">T</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[Aggregate: FileSystem]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">FileSystem</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">createIterator</span><span class="p">():</span> <span class="nc">Iterator</span><span class="p">&lt;</span><span class="nc">File</span><span class="p">&gt;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[ConcreteIterator: BFSIterator, DFSIterator]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">BFSIterator</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">root</span><span class="p">:</span> <span class="nc">File</span><span class="p">)</span> <span class="p">:</span> <span class="nc">Iterator</span><span class="p">&lt;</span><span class="nc">File</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">queue</span> <span class="p">=</span> <span class="nc">ArrayDeque</span><span class="p">&lt;</span><span class="nc">File</span><span class="p">&gt;()</span>

    <span class="nf">init</span> <span class="p">{</span>
        <span class="n">queue</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">hasNext</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">queue</span><span class="p">.</span><span class="nf">isNotEmpty</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">next</span><span class="p">():</span> <span class="nc">File</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(!</span><span class="nf">hasNext</span><span class="p">())</span> <span class="k">throw</span> <span class="nc">NoSuchElementException</span><span class="p">()</span>
        <span class="kd">val</span> <span class="py">current</span> <span class="p">=</span> <span class="n">queue</span><span class="p">.</span><span class="nf">removeFirst</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">current</span><span class="p">.</span><span class="n">isDirectory</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">queue</span><span class="p">.</span><span class="nf">addAll</span><span class="p">(</span><span class="n">current</span><span class="p">.</span><span class="nf">listFiles</span><span class="p">().</span><span class="nf">orEmpty</span><span class="p">())</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">current</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">DFSIterator</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">root</span><span class="p">:</span> <span class="nc">File</span><span class="p">)</span> <span class="p">:</span> <span class="nc">Iterator</span><span class="p">&lt;</span><span class="nc">File</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">stack</span> <span class="p">=</span> <span class="nc">ArrayDeque</span><span class="p">&lt;</span><span class="nc">File</span><span class="p">&gt;()</span>

    <span class="nf">init</span> <span class="p">{</span>
        <span class="n">stack</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">hasNext</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">stack</span><span class="p">.</span><span class="nf">isNotEmpty</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">next</span><span class="p">():</span> <span class="nc">File</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(!</span><span class="nf">hasNext</span><span class="p">())</span> <span class="k">throw</span> <span class="nc">NoSuchElementException</span><span class="p">()</span>
        <span class="kd">val</span> <span class="py">current</span> <span class="p">=</span> <span class="n">stack</span><span class="p">.</span><span class="nf">removeLast</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">current</span><span class="p">.</span><span class="n">isDirectory</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">stack</span><span class="p">.</span><span class="nf">addAll</span><span class="p">(</span><span class="n">current</span><span class="p">.</span><span class="nf">listFiles</span><span class="p">().</span><span class="nf">orEmpty</span><span class="p">())</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">current</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[ConcreteAggregate: DefaultFileSystem]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">DefaultFileSystem</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">root</span><span class="p">:</span> <span class="nc">File</span><span class="p">,</span> <span class="k">private</span> <span class="kd">val</span> <span class="py">searchMethod</span><span class="p">:</span> <span class="nc">SearchMethod</span><span class="p">)</span> <span class="p">:</span> <span class="nc">FileSystem</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">createIterator</span><span class="p">():</span> <span class="nc">Iterator</span><span class="p">&lt;</span><span class="nc">File</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="n">searchMethod</span><span class="p">)</span> <span class="p">{</span>
            <span class="nc">SearchMethod</span><span class="p">.</span><span class="nc">BFS</span> <span class="p">-&gt;</span> <span class="nc">BFSIterator</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
            <span class="nc">SearchMethod</span><span class="p">.</span><span class="nc">DFS</span> <span class="p">-&gt;</span> <span class="nc">DFSIterator</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">enum</span> <span class="kd">class</span> <span class="nc">SearchMethod</span> <span class="p">{</span>
    <span class="nc">BFS</span><span class="p">,</span> <span class="nc">DFS</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[File]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">data class</span> <span class="nc">File</span><span class="p">(</span><span class="kd">val</span> <span class="py">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="kd">val</span> <span class="py">isDirectory</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">,</span> <span class="kd">val</span> <span class="py">children</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">File</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">emptyList</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">listFiles</span><span class="p">():</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">File</span><span class="p">&gt;</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">isDirectory</span><span class="p">)</span> <span class="n">children</span> <span class="k">else</span> <span class="nf">emptyList</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[Client]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">fileSystem</span> <span class="p">=</span> <span class="nc">DefaultFileSystem</span><span class="p">(</span>
        <span class="n">root</span> <span class="p">=</span> <span class="nc">File</span><span class="p">(</span>
            <span class="n">name</span> <span class="p">=</span> <span class="s">"root"</span><span class="p">,</span>
            <span class="n">isDirectory</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span>
            <span class="n">children</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
                <span class="nc">File</span><span class="p">(</span><span class="s">"file1.txt"</span><span class="p">,</span> <span class="k">false</span><span class="p">),</span>
                <span class="nc">File</span><span class="p">(</span><span class="s">"folder1"</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="nf">listOf</span><span class="p">(</span>
                    <span class="nc">File</span><span class="p">(</span><span class="s">"file2.txt"</span><span class="p">,</span> <span class="k">false</span><span class="p">),</span>
                    <span class="nc">File</span><span class="p">(</span><span class="s">"file3.txt"</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
                <span class="p">)),</span>
                <span class="nc">File</span><span class="p">(</span><span class="s">"folder2"</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="nf">listOf</span><span class="p">(</span>
                    <span class="nc">File</span><span class="p">(</span><span class="s">"file4.txt"</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
                <span class="p">))</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="n">searchMethod</span> <span class="p">=</span> <span class="nc">SearchMethod</span><span class="p">.</span><span class="nc">BFS</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">iterator</span> <span class="p">=</span> <span class="n">fileSystem</span><span class="p">.</span><span class="nf">createIterator</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Files:"</span><span class="p">)</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">iterator</span><span class="p">.</span><span class="nf">hasNext</span><span class="p">())</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"- ${iterator.next().name}"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[Output]</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Files:
- root
- file1.txt
- folder1
- folder2
- file2.txt
- file3.txt
- file4.txt
</code></pre></div></div>

<h2 id="çµè«–">çµè«–</h2>

<p>é€é Iterator Patternï¼Œæˆ‘å€‘æˆåŠŸå¯¦ç¾äº†ä¸åŒæœå°‹æ³•çš„æ•´åˆï¼Œè®“å®¢æˆ¶ç«¯èƒ½ä»¥ä¸€è‡´çš„æ–¹å¼è¨ªå•æœå°‹çµæœã€‚æ­¤æ¨¡å¼æå‡äº†ç³»çµ±çš„éˆæ´»æ€§èˆ‡æ“´å±•æ€§ï¼Œç‰¹åˆ¥é©åˆè™•ç†å¤šç¨®éæ­·é‚è¼¯çš„å ´æ™¯ï¼Œä¾‹å¦‚æª”æ¡ˆæœå°‹ã€æ¨¹ç‹€çµæ§‹éæ­·ç­‰ã€‚</p>]]></content><author><name>Nick Huang</name></author><category term="Design Pattern" /><category term="Iterator Pattern" /><summary type="html"><![CDATA[äº†è§£è¿­ä»£å™¨æ¨¡å¼å¦‚ä½•æä¾›ä¸€ç¨®é †åºä¾†è¨ªå•é›†åˆå…§å…ƒç´ çš„æ–¹æ³•ï¼Œè€Œä¸éœ€è¦æš´éœ²é›†åˆçš„åº•å±¤è¡¨ç¤ºã€‚]]></summary></entry><entry><title type="html">Design Pattern (21) - Mediator Pattern (ä¸­ä»‹è€…æ¨¡å¼)</title><link href="https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-21-mediator-pattern/" rel="alternate" type="text/html" title="Design Pattern (21) - Mediator Pattern (ä¸­ä»‹è€…æ¨¡å¼)" /><published>2024-12-22T06:00:00+00:00</published><updated>2024-12-22T06:00:00+00:00</updated><id>https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-21-mediator-pattern</id><content type="html" xml:base="https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-21-mediator-pattern/"><![CDATA[<blockquote>
  <p>æ‚¨å¯æ–¼æ­¤ <a href="https://github.com/nickhuangcyh/design_pattern">design_pattern repo</a> ä¸‹è¼‰ Design Pattern ç³»åˆ—ç¨‹å¼ç¢¼ã€‚</p>
</blockquote>

<h2 id="éœ€æ±‚">éœ€æ±‚</h2>

<p>æˆ‘å€‘çš„ä»»å‹™æ˜¯è¨­è¨ˆä¸€å€‹ <strong>èŠå¤©å®¤æ‡‰ç”¨ç¨‹å¼</strong>ï¼Œéœ€æ±‚å¦‚ä¸‹ï¼š</p>

<ul>
  <li>ä½¿ç”¨è€…å¯ä»¥é€éèŠå¤©å®¤å‚³éè¨Šæ¯ã€‚</li>
  <li>æ¯å€‹ä½¿ç”¨è€…éƒ½ä¸éœ€è¦ç›´æ¥ç®¡ç†å…¶ä»–ä½¿ç”¨è€…çš„è³‡è¨Šã€‚</li>
  <li>æ–°å¢æˆ–ç§»é™¤ä½¿ç”¨è€…ä¸æ‡‰å½±éŸ¿å…¶ä»–ä½¿ç”¨è€…çš„é‹ä½œã€‚</li>
</ul>

<h2 id="ç‰©ä»¶å°å‘åˆ†æ-ooa">ç‰©ä»¶å°å‘åˆ†æ (OOA)</h2>

<p>ç†è§£éœ€æ±‚å¾Œï¼Œæˆ‘å€‘ä¾†å¿«é€Ÿåˆ†æï¼š</p>

<ul>
  <li>è‹¥ä½¿ç”¨è€…å½¼æ­¤ç›´æ¥é€šä¿¡ï¼Œæœƒå°è‡´è¤‡é›œçš„ç›¸ä¾é—œä¿‚ï¼Œå¢åŠ ç¶­è­·æˆæœ¬ã€‚</li>
  <li>æˆ‘å€‘éœ€è¦ä¸€å€‹é›†ä¸­ç®¡ç†çš„è§’è‰²ï¼Œä¾†å”èª¿ä½¿ç”¨è€…ä¹‹é–“çš„è¨Šæ¯å‚³éã€‚</li>
</ul>

<p><img src="/blog/assets/images/design_pattern_mediator_pattern_uml_1.png" alt="mediator_pattern_uml_1" /></p>

<h2 id="å¯Ÿè¦º-forces">å¯Ÿè¦º Forces</h2>

<p>åœ¨æœªä½¿ç”¨è¨­è¨ˆæ¨¡å¼çš„æƒ…æ³ä¸‹ï¼Œæˆ‘å€‘å¯èƒ½é¢è‡¨ä»¥ä¸‹æŒ‘æˆ°ï¼š</p>

<ol>
  <li>
    <p><strong>é«˜è€¦åˆæ€§ (High Coupling)</strong>ï¼š</p>

    <ul>
      <li>ä½¿ç”¨è€…å½¼æ­¤ä¹‹é–“ç›´æ¥é€šä¿¡ï¼Œå°è‡´æ–°å¢æˆ–ç§»é™¤ä½¿ç”¨è€…æ™‚éœ€ä¿®æ”¹å¤šè™•ç¨‹å¼ç¢¼ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>é›£ä»¥æ“´å±• (Hard to Extend)</strong>ï¼š</p>

    <ul>
      <li>è‹¥è¦å¢åŠ æ–°åŠŸèƒ½ï¼ˆå¦‚è¨Šæ¯éæ¿¾æˆ–å»£æ’­æ©Ÿåˆ¶ï¼‰ï¼Œéœ€è¦ä¿®æ”¹å¤šå€‹ä½¿ç”¨è€…çš„é‚è¼¯ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>è¤‡é›œåº¦ä¸Šå‡ (Increased Complexity)</strong>ï¼š</p>

    <ul>
      <li>ä½¿ç”¨è€…ä¹‹é–“çš„é—œè¯æ•¸é‡éš¨è‘—ä½¿ç”¨è€…æ•¸é‡å¢é•·å‘ˆæŒ‡æ•¸ç´šå¢åŠ ã€‚</li>
    </ul>
  </li>
</ol>

<h2 id="å¥—ç”¨-mediator-pattern-solution-å¾—åˆ°æ–°çš„-context-resulting-context">å¥—ç”¨ Mediator Pattern (Solution) å¾—åˆ°æ–°çš„ Context (Resulting Context)</h2>

<p>åšå®Œ OOAï¼Œå¯Ÿè¦º Forcesï¼Œçœ‹æ¸…æ¥šæ•´å€‹ Context å¾Œï¼Œå°±å¯ä»¥ä¾†å¥—ç”¨ Mediator Pattern è§£æ±ºé€™å€‹å•é¡Œã€‚</p>

<p>ä¸­ä»‹è€…æ¨¡å¼å¼•å…¥äº†ä¸€å€‹ä¸­ä»‹è€…ä¾†è² è²¬å”èª¿ä½¿ç”¨è€…ä¹‹é–“çš„äº¤äº’ã€‚ä½¿ç”¨è€…åªéœ€èˆ‡ä¸­ä»‹è€…é€šä¿¡ï¼Œå¾è€Œé™ä½ç›¸äº’ä¹‹é–“çš„è€¦åˆæ€§ã€‚</p>

<p>ä»¥ä¸‹æ˜¯ Mediator Pattern çš„ UML åœ–ï¼š</p>

<p><img src="/blog/assets/images/design_pattern_mediator_pattern_uml_2.png" alt="mediator_pattern_uml_2" /></p>

<p>Mediator Pattern çš„ä¸»è¦è§’è‰²ï¼š</p>

<ul>
  <li><strong>Mediator (ä¸­ä»‹è€…ä»‹é¢)</strong>ï¼šå®šç¾©å”èª¿åƒèˆ‡è€…çš„æ–¹æ³•ï¼Œä¾‹å¦‚å‚³éè¨Šæ¯ã€‚</li>
  <li><strong>ConcreteMediator (å…·é«”ä¸­ä»‹è€…)</strong>ï¼šå¯¦ç¾ä¸­ä»‹è€…çš„è¡Œç‚ºï¼Œè™•ç†ä½¿ç”¨è€…ä¹‹é–“çš„è¨Šæ¯å‚³éã€‚</li>
  <li><strong>Colleague (åŒäº‹é¡åˆ¥)</strong>ï¼šè¡¨ç¤ºåƒèˆ‡è€…ï¼Œæ‰€æœ‰è¨Šæ¯å‡é€šéä¸­ä»‹è€…é€²è¡Œå‚³éã€‚</li>
  <li><strong>ConcreteColleague (å…·é«”åŒäº‹é¡åˆ¥)</strong>ï¼šå¯¦ç¾å…·é«”åƒèˆ‡è€…çš„è¡Œç‚ºï¼Œä¸¦ä¾è³´ä¸­ä»‹è€…é€²è¡Œé€šä¿¡ã€‚</li>
</ul>

<p>è®“æˆ‘å€‘å°‡ Mediator Pattern å¥—ç”¨åˆ°èŠå¤©å®¤æ‡‰ç”¨ç¨‹å¼ä¸­ã€‚</p>

<p><img src="/blog/assets/images/design_pattern_mediator_pattern_uml_3.png" alt="mediator_pattern_uml_3" /></p>

<h2 id="ç‰©ä»¶å°å‘ç¨‹å¼è¨­è¨ˆ-oop">ç‰©ä»¶å°å‘ç¨‹å¼è¨­è¨ˆ (OOP)</h2>

<p>[Mediator]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">ChatMediator</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">sendMessage</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nc">User</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">addUser</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="nc">User</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[ConcreteMediator]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">ChatRoomMediator</span> <span class="p">:</span> <span class="nc">ChatMediator</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">users</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="nc">User</span><span class="p">&gt;()</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">sendMessage</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nc">User</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">users</span><span class="p">.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">it</span> <span class="p">!=</span> <span class="n">user</span> <span class="p">}.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">receive</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">addUser</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="nc">User</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">users</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[Colleague]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">abstract</span> <span class="kd">class</span> <span class="nc">User</span><span class="p">(</span><span class="k">protected</span> <span class="kd">val</span> <span class="py">mediator</span><span class="p">:</span> <span class="nc">ChatMediator</span><span class="p">,</span> <span class="kd">val</span> <span class="py">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">abstract</span> <span class="k">fun</span> <span class="nf">send</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span>
    <span class="k">abstract</span> <span class="k">fun</span> <span class="nf">receive</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[ConcreteColleague]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">ChatUser</span><span class="p">(</span><span class="n">mediator</span><span class="p">:</span> <span class="nc">ChatMediator</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">:</span> <span class="nc">User</span><span class="p">(</span><span class="n">mediator</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">send</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"$name ç™¼é€è¨Šæ¯ï¼š$message"</span><span class="p">)</span>
        <span class="n">mediator</span><span class="p">.</span><span class="nf">sendMessage</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">receive</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"$name æ”¶åˆ°è¨Šæ¯ï¼š$message"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[Client]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">chatMediator</span> <span class="p">=</span> <span class="nc">ChatRoomMediator</span><span class="p">()</span>

    <span class="kd">val</span> <span class="py">user1</span> <span class="p">=</span> <span class="nc">ChatUser</span><span class="p">(</span><span class="n">chatMediator</span><span class="p">,</span> <span class="s">"Alice"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">user2</span> <span class="p">=</span> <span class="nc">ChatUser</span><span class="p">(</span><span class="n">chatMediator</span><span class="p">,</span> <span class="s">"Bob"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">user3</span> <span class="p">=</span> <span class="nc">ChatUser</span><span class="p">(</span><span class="n">chatMediator</span><span class="p">,</span> <span class="s">"Charlie"</span><span class="p">)</span>

    <span class="n">chatMediator</span><span class="p">.</span><span class="nf">addUser</span><span class="p">(</span><span class="n">user1</span><span class="p">)</span>
    <span class="n">chatMediator</span><span class="p">.</span><span class="nf">addUser</span><span class="p">(</span><span class="n">user2</span><span class="p">)</span>
    <span class="n">chatMediator</span><span class="p">.</span><span class="nf">addUser</span><span class="p">(</span><span class="n">user3</span><span class="p">)</span>

    <span class="n">user1</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="s">"Hello, everyone!"</span><span class="p">)</span>
    <span class="n">user2</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="s">"Hi, Alice!"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>[Output]</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Alice</span> <span class="err">ç™¼é€è¨Šæ¯ï¼š</span><span class="nc">Hello</span><span class="p">,</span> <span class="n">everyone</span><span class="p">!</span>
<span class="nc">Bob</span> <span class="err">æ”¶åˆ°è¨Šæ¯ï¼š</span><span class="nc">Hello</span><span class="p">,</span> <span class="n">everyone</span><span class="p">!</span>
<span class="nc">Charlie</span> <span class="err">æ”¶åˆ°è¨Šæ¯ï¼š</span><span class="nc">Hello</span><span class="p">,</span> <span class="n">everyone</span><span class="p">!</span>
<span class="nc">Bob</span> <span class="err">ç™¼é€è¨Šæ¯ï¼š</span><span class="nc">Hi</span><span class="p">,</span> <span class="nc">Alice</span><span class="p">!</span>
<span class="nc">Alice</span> <span class="err">æ”¶åˆ°è¨Šæ¯ï¼š</span><span class="nc">Hi</span><span class="p">,</span> <span class="nc">Alice</span><span class="p">!</span>
<span class="nc">Charlie</span> <span class="err">æ”¶åˆ°è¨Šæ¯ï¼š</span><span class="nc">Hi</span><span class="p">,</span> <span class="nc">Alice</span><span class="p">!</span>
</code></pre></div></div>

<h2 id="çµè«–">çµè«–</h2>

<p>é€éä¸­ä»‹è€…æ¨¡å¼ï¼Œæˆ‘å€‘æˆåŠŸé™ä½äº†ä½¿ç”¨è€…ä¹‹é–“çš„è€¦åˆæ€§ï¼Œä¸¦å¯¦ç¾äº†éˆæ´»çš„è¨Šæ¯å‚³éæ©Ÿåˆ¶ã€‚æ­¤æ¨¡å¼éå¸¸é©åˆè™•ç†å¤šç‰©ä»¶ä¹‹é–“çš„äº¤äº’ï¼Œä¾‹å¦‚èŠå¤©å®¤ã€äº‹ä»¶ç³»çµ±æˆ– GUI çµ„ä»¶é€šä¿¡ç­‰å ´æ™¯ã€‚</p>]]></content><author><name>Nick Huang</name></author><category term="Design Pattern" /><category term="Mediator Pattern" /><summary type="html"><![CDATA[äº†è§£ä¸­ä»‹è€…æ¨¡å¼å¦‚ä½•å”èª¿ç‰©ä»¶ä¹‹é–“çš„äº¤äº’ï¼Œæ¸›å°‘ç‰©ä»¶ä¹‹é–“çš„è€¦åˆæ€§ä¸¦ä¿ƒé€²ç³»çµ±çš„å¯æ“´å±•æ€§ã€‚]]></summary></entry><entry><title type="html">Design Pattern (22) - Memento Pattern (å‚™å¿˜éŒ„æ¨¡å¼)</title><link href="https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-22-memento-pattern/" rel="alternate" type="text/html" title="Design Pattern (22) - Memento Pattern (å‚™å¿˜éŒ„æ¨¡å¼)" /><published>2024-12-22T06:00:00+00:00</published><updated>2024-12-22T06:00:00+00:00</updated><id>https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-22-memento-pattern</id><content type="html" xml:base="https://nickhuangcyh.github.io/blog/design%20pattern/design-pattern-22-memento-pattern/"><![CDATA[<blockquote>
  <p>æ‚¨å¯æ–¼æ­¤ <a href="https://github.com/nickhuangcyh/design_pattern">design_pattern repo</a> ä¸‹è¼‰ Design Pattern ç³»åˆ—ç¨‹å¼ç¢¼ã€‚</p>
</blockquote>

<h2 id="éœ€æ±‚">éœ€æ±‚</h2>

<p>æˆ‘å€‘çš„ä»»å‹™æ˜¯è¨­è¨ˆä¸€å€‹æ–‡å­—ç·¨è¼¯å™¨ï¼Œéœ€æ±‚å¦‚ä¸‹ï¼š</p>

<ul>
  <li>ä½¿ç”¨è€…å¯ä»¥è¼¸å…¥æ–‡å­—ï¼Œä¸¦éš¨æ™‚æŒ‰ä¸‹ <code class="language-plaintext highlighter-rouge">Ctrl+Z</code> å›å¾©ä¸Šä¸€æ­¥ã€‚</li>
  <li>ç³»çµ±éœ€è¦ä¿å­˜æ­·å²ç‹€æ…‹ä»¥ä¾›å›å¾©ã€‚</li>
  <li>å®¢æˆ¶ç«¯ä¸éœ€è¦äº†è§£ç‹€æ…‹ä¿å­˜çš„å¯¦ç¾ç´°ç¯€ï¼Œåªéœ€ä½¿ç”¨ä¸€å€‹ç°¡å–®çš„å›å¾©æ“ä½œå³å¯ã€‚</li>
</ul>

<h2 id="ç‰©ä»¶å°å‘åˆ†æ-ooa">ç‰©ä»¶å°å‘åˆ†æ (OOA)</h2>

<p>ç†è§£éœ€æ±‚å¾Œï¼Œè®“æˆ‘å€‘ä¾†å¿«é€Ÿå¯¦ä½œç‰©ä»¶å°å‘åˆ†æå§!</p>

<p><img src="/blog/assets/images/design_pattern_memento_pattern_uml_1.png" alt="memento_pattern_uml_1" /></p>

<h3 id="å¯Ÿè¦º-forces">å¯Ÿè¦º Forces</h3>

<p>åœ¨æœªä½¿ç”¨è¨­è¨ˆæ¨¡å¼çš„æƒ…æ³ä¸‹ï¼Œæˆ‘å€‘å¯èƒ½é¢è‡¨ä»¥ä¸‹æŒ‘æˆ°ï¼š</p>

<ol>
  <li>
    <p><strong>è³‡æ–™å–ªå¤±é¢¨éšª (Data Loss Risk)</strong>ï¼š</p>

    <ul>
      <li>å¦‚æœæˆ‘å€‘åƒ…ä¿ç•™ç•¶å‰ç‹€æ…‹ï¼Œå°‡ç„¡æ³•å›å¾©åˆ°ä¹‹å‰çš„ç‹€æ…‹ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>é«˜è€¦åˆæ€§ (High Coupling)</strong>ï¼š</p>

    <ul>
      <li>å®¢æˆ¶ç«¯éœ€è¦ç›´æ¥æ“ä½œç‹€æ…‹ç®¡ç†é‚è¼¯ï¼Œå°è‡´è¤‡é›œæ€§å¢åŠ ã€‚</li>
    </ul>
  </li>
  <li>
    <p><strong>é›£ä»¥æ“´å±• (Hard to Extend)</strong>ï¼š</p>

    <ul>
      <li>æ–°å¢åŠŸèƒ½æˆ–æ”¹è®Šç‹€æ…‹ä¿å­˜æ–¹å¼æ™‚ï¼Œå¯èƒ½éœ€è¦ä¿®æ”¹å¤§é‡ç¨‹å¼ç¢¼ã€‚</li>
    </ul>
  </li>
</ol>

<h2 id="å¥—ç”¨-memento-pattern-solution-å¾—åˆ°æ–°çš„-context-resulting-context">å¥—ç”¨ Memento Pattern (Solution) å¾—åˆ°æ–°çš„ Context (Resulting Context)</h2>

<p>åšå®Œ OOAï¼Œå¯Ÿè¦º Forcesï¼Œçœ‹æ¸…æ¥šæ•´å€‹ Context å¾Œï¼Œå°±å¯ä»¥ä¾†å¥—ç”¨ Memento Pattern è§£æ±ºé€™å€‹å•é¡Œ</p>

<p>å…ˆä¾†çœ‹ä¸€ä¸‹ Memento Pattern çš„ UML</p>

<p><img src="/blog/assets/images/design_pattern_memento_pattern_uml_2.png" alt="memento_pattern_uml_2" /></p>

<p>å‚™å¿˜éŒ„æ¨¡å¼å¼•å…¥äº†ä¸‰å€‹è§’è‰²ï¼š</p>

<ol>
  <li><strong>Originator (ç™¼èµ·è€…)</strong>ï¼šä¿å­˜ç•¶å‰ç‹€æ…‹åˆ°å‚™å¿˜éŒ„ï¼Œæˆ–å¾å‚™å¿˜éŒ„ä¸­æ¢å¾©ç‹€æ…‹ã€‚</li>
  <li><strong>Memento (å‚™å¿˜éŒ„)</strong>ï¼šå­˜å„² Originator çš„å…§éƒ¨ç‹€æ…‹ã€‚</li>
  <li><strong>Caretaker (ç®¡ç†è€…)</strong>ï¼šè² è²¬ä¿å­˜å’Œæ¢å¾©å‚™å¿˜éŒ„ï¼Œä½†ä¸ç›´æ¥æ“ä½œå…¶å…§å®¹ã€‚</li>
</ol>

<p>å°‡ Memento Pattern å¥—ç”¨åˆ°æˆ‘å€‘çš„æ‡‰ç”¨å§</p>

<p><img src="/blog/assets/images/design_pattern_memento_pattern_uml_3.png" alt="memento_pattern_uml_3" /></p>

<h2 id="ç‰©ä»¶å°å‘ç¨‹å¼è¨­è¨ˆ-oop">ç‰©ä»¶å°å‘ç¨‹å¼è¨­è¨ˆ (OOP)</h2>

<h3 id="originator">Originator</h3>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TextEditor</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">text</span><span class="p">:</span> <span class="nc">String</span> <span class="p">=</span> <span class="s">""</span>

    <span class="k">fun</span> <span class="nf">type</span><span class="p">(</span><span class="n">newText</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">text</span> <span class="p">+=</span> <span class="n">newText</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">getText</span><span class="p">():</span> <span class="nc">String</span> <span class="p">=</span> <span class="n">text</span>

    <span class="k">fun</span> <span class="nf">save</span><span class="p">():</span> <span class="nc">Memento</span> <span class="p">=</span> <span class="nc">Memento</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">fun</span> <span class="nf">restore</span><span class="p">(</span><span class="n">memento</span><span class="p">:</span> <span class="nc">Memento</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">text</span> <span class="p">=</span> <span class="n">memento</span><span class="p">.</span><span class="nf">getText</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">data class</span> <span class="nc">Memento</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">state</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">fun</span> <span class="nf">getText</span><span class="p">():</span> <span class="nc">String</span> <span class="p">=</span> <span class="n">state</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="caretaker">Caretaker</h3>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">History</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">mementos</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="nc">TextEditor</span><span class="p">.</span><span class="nc">Memento</span><span class="p">&gt;()</span>

    <span class="k">fun</span> <span class="nf">save</span><span class="p">(</span><span class="n">memento</span><span class="p">:</span> <span class="nc">TextEditor</span><span class="p">.</span><span class="nc">Memento</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">mementos</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">memento</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">undo</span><span class="p">():</span> <span class="nc">TextEditor</span><span class="p">.</span><span class="nc">Memento</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mementos</span><span class="p">.</span><span class="nf">isNotEmpty</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">mementos</span><span class="p">.</span><span class="nf">removeAt</span><span class="p">(</span><span class="n">mementos</span><span class="p">.</span><span class="n">size</span> <span class="p">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">null</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="client">Client</h3>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">textEditor</span> <span class="p">=</span> <span class="nc">TextEditor</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">history</span> <span class="p">=</span> <span class="nc">History</span><span class="p">()</span>

    <span class="c1">// Typing string</span>
    <span class="n">textEditor</span><span class="p">.</span><span class="nf">type</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">)</span>
    <span class="n">history</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="n">textEditor</span><span class="p">.</span><span class="nf">save</span><span class="p">())</span>

    <span class="n">textEditor</span><span class="p">.</span><span class="nf">type</span><span class="p">(</span><span class="s">", World"</span><span class="p">)</span>
    <span class="n">history</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="n">textEditor</span><span class="p">.</span><span class="nf">save</span><span class="p">())</span>

    <span class="n">textEditor</span><span class="p">.</span><span class="nf">type</span><span class="p">(</span><span class="s">"! This is Memento Pattern."</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Current Textï¼š${textEditor.getText()}"</span><span class="p">)</span> <span class="c1">// Output: Hello, World! This is Memento Pattern.</span>

    <span class="c1">// Pressed Ctrl+Z</span>
    <span class="n">textEditor</span><span class="p">.</span><span class="nf">restore</span><span class="p">(</span><span class="n">history</span><span class="p">.</span><span class="nf">undo</span><span class="p">()</span><span class="o">!!</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Excute undo Textï¼š${textEditor.getText()}"</span><span class="p">)</span> <span class="c1">// Output: Hello, World!</span>

    <span class="c1">// Pressed Ctrl+Z again</span>
    <span class="n">textEditor</span><span class="p">.</span><span class="nf">restore</span><span class="p">(</span><span class="n">history</span><span class="p">.</span><span class="nf">undo</span><span class="p">()</span><span class="o">!!</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Excute undo Textï¼š${textEditor.getText()}"</span><span class="p">)</span> <span class="c1">// Output: Hello</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="output">Output</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Current Textï¼š Hello, World! This is Memento Pattern.
Excute undo Textï¼š Hello, World!
Excute undo Textï¼š Hello
</code></pre></div></div>

<h2 id="çµè«–">çµè«–</h2>

<p>é€éå‚™å¿˜éŒ„æ¨¡å¼ï¼Œæˆ‘å€‘æˆåŠŸå¯¦ç¾äº†æ–‡å­—ç·¨è¼¯å™¨çš„ç‹€æ…‹æ¢å¾©åŠŸèƒ½ï¼Œè®“ä½¿ç”¨è€…èƒ½å¤ è¼•é¬†åœ°å›å¾©åˆ°ä¹‹å‰çš„æ“ä½œç‹€æ…‹ã€‚é€™ç¨®æ¨¡å¼å»£æ³›æ‡‰ç”¨æ–¼æ–‡å­—è™•ç†å™¨ã€éŠæˆ²ä¿å­˜ç³»çµ±ä»¥åŠå…¶ä»–éœ€è¦ç‹€æ…‹æ¢å¾©çš„å ´æ™¯ã€‚</p>]]></content><author><name>Nick Huang</name></author><category term="Design Pattern" /><category term="Memento Pattern" /><summary type="html"><![CDATA[äº†è§£å‚™å¿˜éŒ„æ¨¡å¼å¦‚ä½•å¹«åŠ©æˆ‘å€‘å¯¦ç¾ç‹€æ…‹æ¢å¾©ï¼Œåƒæ˜¯å¸¸è¦‹çš„ Ctrl+Z åŠŸèƒ½ï¼Œè®“æˆ‘å€‘å›åˆ°ä¹‹å‰çš„æ“ä½œç‹€æ…‹ã€‚]]></summary></entry></feed>